(this["webpackJsonpagora-edu-web"]=this["webpackJsonpagora-edu-web"]||[]).push([[0],{111:function(e,t,a){},152:function(e,t,a){e.exports=a(237)},157:function(e,t,a){},162:function(e,t,a){},165:function(e,t,a){},183:function(e,t){},185:function(e,t){},205:function(e,t){},217:function(e,t,a){},218:function(e,t,a){},219:function(e,t,a){},220:function(e,t,a){},221:function(e,t,a){},222:function(e,t,a){},223:function(e,t,a){},224:function(e,t,a){},226:function(e,t,a){},227:function(e,t,a){},228:function(e,t,a){},230:function(e,t,a){},231:function(e,t,a){},232:function(e,t,a){},233:function(e,t,a){},234:function(e,t,a){},235:function(e,t,a){},237:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(20),o=a.n(c),s=(a(157),a(30)),i=a(37),u=r.a.createContext({});var l=function(e){var t=e.children;return r.a.createElement(i.a,null,r.a.createElement(s.b,null,(function(e){return r.a.createElement(u.Provider,{value:e},t)})))},m=a(271),d=a(140),h=Object(d.a)({typography:{fontFamily:'-apple-system, BlinkMacSystemFont, \\"Segoe UI\\", \\"Roboto\\", \\"Oxygen\\", \\"Ubuntu\\", \\"Cantarell\\", \\"Fira Sans\\", \\"Droid Sans\\", \\"Helvetica Neue\\", sans-serif',fontSize:14,fontWeightLight:300,fontWeightRegular:400,fontWeightMedium:500},overrides:{MuiRadio:{root:{padding:"4px"}},MuiSvgIcon:{root:{width:"1rem",height:"1rem"}},MuiFormControl:{root:{margin:"0.3rem 0"}},MuiInput:{underline:{"&:before":{borderBottom:"1px solid #EAEAEA"},"&:hover:not($disabled):not($focused):not($error):before":{borderBottom:"2px solid #EAEAEA"},"&$focused":{"&:after":{borderBottom:"2px solid #44a2fc"}}}}}}),f=function(e){var t=e.children;return r.a.createElement(m.a,{theme:h},t)},p=a(4),v=a(12),b=a(279),g=a(275),_=a(272),E=function(e){return r.a.createElement(_.a,{variant:"contained",className:e.className?e.className:"custom-button",color:"primary",onClick:e.onClick},e.name)},y=a(289),k=a(276),O=a(285),w=a(145),C=(a(162),a(19)),j=a(16),x=a(141),S=a(14),T=a.n(S),N=new(function(){function e(){Object(C.a)(this,e),this.storage=void 0,this.storage=window.sessionStorage}return Object(j.a)(e,[{key:"read",value:function(e){try{return JSON.parse(this.storage.getItem(e))}catch(t){return this.storage.getItem(e)}}},{key:"save",value:function(e,t){this.storage.setItem(e,JSON.stringify(t))}},{key:"clear",value:function(e){this.storage.removeItem(e)}},{key:"getLanguage",value:function(){return{language:this.read("language")?this.read("language"):navigator.language}}},{key:"getRtmMessage",value:function(){var e=N.read("channelMessages");if(Object(S.isEmpty)(e))return{count:0,messages:[]};var t=e.filter((function(e){return"group_message"===e.message_type})).reduce((function(e,t){var a=t.payload,n=JSON.parse(a);return n.content?e.concat({account:n.account,content:n.content,ms:t.ms,src:t.src}):e}),[]);return{messages:t,count:t.length}}}]),e}());window.GlobalStorage=N;var P=N,A=[{value:0,text:"home.1v1",path:"one-to-one"},{value:1,text:"home.mini_class",path:"small-class"},{value:2,text:"home.large_class",path:"big-class"}],I=new(function(){function e(){Object(C.a)(this,e),this.subject=void 0,this.state=void 0,this.defaultState=Object(p.a)({loading:!1,toast:{type:"",message:""},dialog:{type:"",message:"",confirmText:"confirm",cancelText:"cancel"},uploadNotice:{type:"",title:""},notice:{reason:"",text:""},nativeWindowInfo:{visible:!1,items:[]},active:"chatroom",language:navigator.language,newMessageCount:0},P.getLanguage()),this.subject=null,this.state=this.defaultState}return Object(j.a)(e,[{key:"initialize",value:function(){this.subject=new x.a,this.state=Object(p.a)({},this.defaultState),this.subject.next(this.state)}},{key:"subscribe",value:function(e){this.initialize(),this.subject&&this.subject.subscribe(e)}},{key:"unsubscribe",value:function(){this.subject&&this.subject.unsubscribe(),this.subject=null}},{key:"commit",value:function(e){this.subject&&this.subject.next(e)}},{key:"updateState",value:function(e){this.state=Object(p.a)({},this.state,{},e),this.commit(this.state)}},{key:"showNotice",value:function(e){var t=e.reason,a=e.text;this.state=Object(p.a)({},this.state,{notice:{text:a,reason:t}}),this.commit(this.state)}},{key:"removeNotice",value:function(){this.state=Object(p.a)({},this.state,{notice:{text:"",reason:""}}),this.commit(this.state)}},{key:"setNativeWindowInfo",value:function(e){var t=e.visible,a=e.items;this.state=Object(p.a)({},this.state,{nativeWindowInfo:{visible:t,items:a}}),this.commit(this.state)}},{key:"showUploadNotice",value:function(e){var t=e.type,a=e.title;this.state=Object(p.a)({},this.state,{uploadNotice:{type:t,title:a}}),this.commit(this.state)}},{key:"removeUploadNotice",value:function(){this.state=Object(p.a)({},this.state,{uploadNotice:{type:"",title:""}}),this.commit(this.state)}},{key:"showToast",value:function(e){var t=e.type,a=e.message;this.state=Object(p.a)({},this.state,{toast:{type:t,message:a}}),this.commit(this.state)}},{key:"showDialog",value:function(e){var t=e.type,a=e.message;this.state=Object(p.a)({},this.state,{dialog:{type:t,message:a}}),this.commit(this.state)}},{key:"removeDialog",value:function(){this.state=Object(p.a)({},this.state,{dialog:{type:"",message:""}}),this.commit(this.state)}},{key:"showLoading",value:function(){this.state=Object(p.a)({},this.state,{loading:!0}),this.commit(this.state)}},{key:"stopLoading",value:function(){this.state=Object(p.a)({},this.state,{loading:!1}),this.commit(this.state)}},{key:"setLanguage",value:function(e){this.state=Object(p.a)({},this.state,{language:e}),this.commit(this.state),P.save("language",this.state.language),window.location.reload()}},{key:"setActive",value:function(e){this.state="chatroom"!==e?Object(p.a)({},this.state,{active:e}):Object(p.a)({},this.state,{active:e,newMessageCount:0}),this.commit(this.state)}},{key:"setMessageCount",value:function(e){this.state=Object(p.a)({},this.state,{newMessageCount:e}),this.commit(this.state)}}]),e}());window.globalStore=I;var R=Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_AGORA_APP_ID:"3a1a2513fbd24bd980a411d32f20307d",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_AGORA_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_AGORA_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_AGORA_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_AGORA_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_AGORA_RECORDING_OSS_URL:"oss_url",REACT_APP_AGORA_RECORDING_SERVICE_URL:"https://apiagoraio.herewhite.com",REACT_APP_NETLESS_APP_API_ENTRY:"https://cloudcapiv4.herewhite.com/room?token=",REACT_APP_NETLESS_APP_JOIN_API:"https://cloudcapiv4.herewhite.com/room/join?token=",REACT_APP_NETLESS_APP_TOKEN:"WHITEcGFydG5lcl9pZD0xTnd5aDBsMW9ZazhaRWNuZG1kaWgwcmJjVWVsQnE1UkpPMVMmc2lnPWI5ZGRmNTU1YTgwM2Q0NjFjMDY5YTQ3NDA2ZDMxN2Q5NTVmYTJjYjY6YWRtaW5JZD01MjEmcm9sZT1taW5pJmV4cGlyZV90aW1lPTE2MDM3OTIwOTMmYWs9MU53eWgwbDFvWWs4WkVjbmRtZGloMHJiY1VlbEJxNVJKTzFTJmNyZWF0ZV90aW1lPTE1NzIyMzUxNDEmbm9uY2U9MTU3MjIzNTE0MDY3MTAw",REACT_APP_RUNTIME_PLATFORM:"web"}).REACT_APP_BUILD_VERSION,M={return:{home:"\u8fd4\u56de\u4e3b\u9875"},error:{not_found:"\u9875\u9762\u627e\u4e0d\u5230",components:{paramsEmpty:"\u53c2\u6570\uff1a{reason}\u4e0d\u80fd\u4e3a\u7a7a"}},whiteboard:{loading:"\u52a0\u8f7d\u4e2d..."},toast:{api_login_failured:"\u623f\u95f4\u52a0\u5165\u5931\u8d25, \u539f\u56e0: {reason}",confirm:"\u786e\u5b9a",cancel:"\u53d6\u6d88",quit_room:"\u786e\u5b9a\u9000\u51fa\u8bfe\u7a0b\u5417\uff1f",kick:"\u5176\u4ed6\u7aef\u767b\u5f55\uff0c\u88ab\u8e22\u51fa\u623f\u95f4",login_failure:"\u767b\u5f55\u623f\u95f4\u5931\u8d25",whiteboard_lock:"\u8bbe\u7f6e\u767d\u677f\u8ddf\u968f",whiteboard_unlock:"\u53d6\u6d88\u767d\u677f\u8ddf\u968f",canceled_screen_share:"\u5df2\u53d6\u6d88\u5c4f\u5e55\u5171\u4eab",screen_sharing_failed:"\u5c4f\u5e55\u5206\u4eab\u5931\u8d25, \u539f\u56e0\uff1a{reason}",recording_failed:"\u5f00\u542f\u4e91\u5f55\u5236\u5931\u8d25, \u539f\u56e0\uff1a{reason}",start_recording:"\u5f00\u59cb\u4e91\u5f55\u5236",stop_recording:"\u7ed3\u675f\u4e91\u5f55\u5236",recording_too_short:"\u5f55\u5236\u592a\u77ed\uff0c\u81f3\u5c1115\u79d2",rtm_login_failed:"\u623f\u95f4\u767b\u5f55\u5931\u8d25, \u8bf7\u68c0\u67e5\u7f51\u7edc\u8bbe\u7f6e",rtm_login_failed_reason:"\u623f\u95f4\u767b\u5f55\u5931\u8d25, \u539f\u56e0\uff1a {reason}",replay_failed:"\u56de\u653e\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5",teacher_exists:"\u8be5\u623f\u95f4\u8001\u5e08\u5df2\u5b58\u5728\uff0c\u8bf7\u7b49\u5f8530\u79d2\u6216\u91cd\u65b0\u521b\u5efa\u6559\u5ba4",student_over_limit:"\u8d85\u51fa\u5b66\u751f\u6700\u5927\u4eba\u6570\uff0c\u8bf7\u7b49\u5f8530\u79d2\u6216\u91cd\u65b0\u521b\u5efa\u6559\u5ba4",teacher_and_student_over_limit:"\u8d85\u51fa\u5b66\u751f\u548c\u8001\u5e08\u7684\u6700\u5927\u4eba\u6570",teacher_accept_whiteboard:"\u8001\u5e08\u5df2\u6388\u6743\u4e86\u4f60\u767d\u677f\u7684\u6743\u9650",teacher_cancel_whiteboard:"\u8001\u5e08\u5df2\u6536\u56de\u4e86\u4f60\u767d\u677f\u7684\u6743\u9650",teacher_accept_co_video:"\u8001\u5e08\u5df2\u5141\u8bb8\u8fde\u9ea6",teacher_reject_co_video:"\u8001\u5e08\u5df2\u62d2\u7edd\u8fde\u9ea6",teacher_cancel_co_video:"\u8001\u5e08\u5df2\u53d6\u6d88\u8fde\u9ea6",student_cancel_co_video:"\u5b66\u751f\u5df2\u53d6\u6d88\u8fde\u9ea6"},notice:{student_interactive_apply:'"{reason}"\u60f3\u548c\u4f60\u8fde\u9ea6'},chat:{placeholder:"\u8bf4\u70b9\u4ec0\u4e48",banned:"\u7981\u8a00\u4e2d",send:"\u53d1\u9001"},device:{camera:"\u6444\u50cf\u5934",microphone:"\u9ea6\u514b\u98ce",speaker:"\u626c\u58f0\u5668",finish:"\u5b8c\u6210"},nav:{delay:"\u5ef6\u8fdf: ",network:"\u7f51\u7edc: ",cpu:"CPU: ",class_end:"\u8bfe\u7a0b\u7ed3\u675f",class_start:"\u8bfe\u7a0b\u5f00\u59cb"},home:{"entry-home":"\u8fdb\u5165\u6559\u5ba4",teacher:"\u8001\u5e08",student:"\u5b66\u751f",cover_class:"cover-cn",room_name:"\u623f\u95f4\u540d",nickname:"\u6635\u79f0",room_type:"\u623f\u95f4\u7c7b\u578b",room_join:"\u52a0\u5165\u623f\u95f4",short_title:{title:"\u58f0\u7f51\u4e91\u8bfe\u5802",subtitle:"\u7531\u58f0\u7f51\u63d0\u4f9b"},name_too_long:"\u540d\u5b57\u8fc7\u957f\uff0c\u4e0d\u5f97\u8d85\u8fc720\u4e2a\u5b57\u7b26","1v1":"\u4e00\u5bf9\u4e00",mini_class:"\u5c0f\u73ed\u8bfe",large_class:"\u5927\u73ed\u8bfe",missing_room_name:"\u7f3a\u5c11\u623f\u95f4\u540d",missing_your_name:"\u7f3a\u5c11\u6635\u79f0",missing_password:"\u7f3a\u5c11\u623f\u95f4\u5bc6\u7801",missing_role:"\b\u7f3a\u5c11\u89d2\u8272",account:"\u59d3\u540d",password:"\u5bc6\u7801"},room:{chat_room:"\u6d88\u606f\u5217\u8868",student_list:"\u5b66\u751f\u5217\u8868",uploading:"\u4e0a\u4f20\u4e2d...",converting:"\u8f6c\u6362\u4e2d...",upload_success:"\u4e0a\u4f20\u6210\u529f",upload_failure:"\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc",convert_success:"\u8f6c\u6362\u6210\u529f",convert_failure:"\u8f6c\u6362\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc"},replay:{loading:"\u52a0\u8f7d\u4e2d..."},build_version:"\u6784\u5efa\u7248\u672c: ".concat(R||"0.0.1")},D=Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_AGORA_APP_ID:"3a1a2513fbd24bd980a411d32f20307d",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_AGORA_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_AGORA_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_AGORA_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_AGORA_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_AGORA_RECORDING_OSS_URL:"oss_url",REACT_APP_AGORA_RECORDING_SERVICE_URL:"https://apiagoraio.herewhite.com",REACT_APP_NETLESS_APP_API_ENTRY:"https://cloudcapiv4.herewhite.com/room?token=",REACT_APP_NETLESS_APP_JOIN_API:"https://cloudcapiv4.herewhite.com/room/join?token=",REACT_APP_NETLESS_APP_TOKEN:"WHITEcGFydG5lcl9pZD0xTnd5aDBsMW9ZazhaRWNuZG1kaWgwcmJjVWVsQnE1UkpPMVMmc2lnPWI5ZGRmNTU1YTgwM2Q0NjFjMDY5YTQ3NDA2ZDMxN2Q5NTVmYTJjYjY6YWRtaW5JZD01MjEmcm9sZT1taW5pJmV4cGlyZV90aW1lPTE2MDM3OTIwOTMmYWs9MU53eWgwbDFvWWs4WkVjbmRtZGloMHJiY1VlbEJxNVJKTzFTJmNyZWF0ZV90aW1lPTE1NzIyMzUxNDEmbm9uY2U9MTU3MjIzNTE0MDY3MTAw",REACT_APP_RUNTIME_PLATFORM:"web"}).REACT_APP_BUILD_VERSION,L={return:{home:"Back To Home"},error:{not_found:"Page Not Found",components:{paramsEmpty:"params\uff1a{reason} can`t be empty"}},whiteboard:{loading:"Loading..."},toast:{api_login_failured:"Join Failured, Reason: {reason}",confirm:"Confirm",cancel:"Cancel",quit_room:"Are you sure to exit the classroom?",kick:"kicked",login_failure:"login failure",whiteboard_lock:"Whiteboard follow",whiteboard_unlock:"Whiteboard nofollow",canceled_screen_share:"Canceled screen sharing",screen_sharing_failed:"Screen sharing failed, reason: {reason}",recording_failed:"Start cloud recording failed, reason: {reason}",start_recording:"Start cloud recording success",stop_recording:"Stop cloud recording success",recording_too_short:"Recording too short, at least 15 seconds",rtm_login_failed:"login failure, please check your network",rtm_login_failed_reason:"login failure, reason: {reason}",replay_failed:"Replay Failed please refresh browser",teacher_exists:"Teacher already exists, Please waiting for 30s or reopen new class",student_over_limit:"Student have reached upper limit, , Please waiting for 30s or rejoin new class",teacher_and_student_over_limit:"The number of students and teacher have reached upper limit",teacher_accept_whiteboard:"Teacher already grant your whiteboard",teacher_cancel_whiteboard:"Teacher already cancel your whiteboard",teacher_accept_co_video:"Teacher already accept co-video",teacher_reject_co_video:"Teacher already rejected co-video",teacher_cancel_co_video:"Teacher already canceled co-video",student_cancel_co_video:"Student canceled co-video"},notice:{student_interactive_apply:'"{reason}" wants to interact with you'},chat:{placeholder:"Input Message",banned:"Banned",send:"send"},device:{camera:"Camera",microphone:"Microphone",speaker:"Speaker",finish:"Finish"},nav:{delay:"Delay: ",network:"Network: ",cpu:"CPU: ",class_end:"Class end",class_start:"Class start"},home:{"entry-home":"Join Classroom",teacher:"teacher",student:"student",cover_class:"cover-en",room_name:"Room Name",nickname:"Your Name",room_type:"Room Type",room_join:"Join",short_title:{title:"Agora Cloud Class",subtitle:"Powered by agora.io, a leading online learning engagement platform"},name_too_long:"name too long, should <= 20 characters","1v1":"One to One Classroom",mini_class:"Small Classroom",large_class:"Lecture Hall",missing_room_name:"missing room name",missing_your_name:"missing your name",missing_password:"missing password",missing_role:"missing role",account:"nickname",password:"password"},room:{chat_room:"Chat Room",student_list:"Student List",uploading:"Uploading...",converting:"Converting...",upload_success:"upload success",upload_failure:"upload failure, check the network",convert_success:"convert success",convert_failure:"convert failure, check the network"},replay:{loading:"loading..."},build_version:"build version: ".concat(D||"0.0.1")},U=(Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_AGORA_APP_ID:"3a1a2513fbd24bd980a411d32f20307d",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_AGORA_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_AGORA_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_AGORA_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_AGORA_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_AGORA_RECORDING_OSS_URL:"oss_url",REACT_APP_AGORA_RECORDING_SERVICE_URL:"https://apiagoraio.herewhite.com",REACT_APP_NETLESS_APP_API_ENTRY:"https://cloudcapiv4.herewhite.com/room?token=",REACT_APP_NETLESS_APP_JOIN_API:"https://cloudcapiv4.herewhite.com/room/join?token=",REACT_APP_NETLESS_APP_TOKEN:"WHITEcGFydG5lcl9pZD0xTnd5aDBsMW9ZazhaRWNuZG1kaWgwcmJjVWVsQnE1UkpPMVMmc2lnPWI5ZGRmNTU1YTgwM2Q0NjFjMDY5YTQ3NDA2ZDMxN2Q5NTVmYTJjYjY6YWRtaW5JZD01MjEmcm9sZT1taW5pJmV4cGlyZV90aW1lPTE2MDM3OTIwOTMmYWs9MU53eWgwbDFvWWs4WkVjbmRtZGloMHJiY1VlbEJxNVJKTzFTJmNyZWF0ZV90aW1lPTE1NzIyMzUxNDEmbm9uY2U9MTU3MjIzNTE0MDY3MTAw",REACT_APP_RUNTIME_PLATFORM:"web"}).REACT_APP_BUILD_VERSION,function(e,t){var a=I.state.language.match(/zh/)?M:L,n=Object(S.get)(a,e,null);return n?(Object(S.isEmpty)(t)||t.reason&&n.match(/\{.+\}/)&&(n=n.replace(/\{.+\}/,t.reason)),n):(console.error("".concat(a,": ").concat(e," has no match")),"".concat(a,".").concat(e))}),W=Object(g.a)((function(e){return{radioGroup:{display:"block",clear:"both",justifyContent:"space-between"},required:{fontSize:"12px",color:"#ff0000",lineHeight:"17px",position:"absolute",top:"23px"}}})),B=function(e){var t=W();return r.a.createElement(y.a,{className:t.radioGroup,row:!0,value:e.role,onChange:e.onChange},r.a.createElement(k.a,{className:"custom-radio align-left",value:"teacher",control:r.a.createElement(O.a,{className:"custom-radio",color:"primary"}),label:U("home.teacher"),labelPlacement:"end"}),r.a.createElement(k.a,{className:"custom-radio align-right",value:"student",control:r.a.createElement(O.a,{className:"custom-radio",color:"primary"}),label:U("home.student"),labelPlacement:"end"}),e.requiredText?r.a.createElement(w.a,{className:t.required},e.requiredText):null)},V=function(e){var t=e.data,a=e.icon,n=e.disable,c=e.className,o=e.onClick,s=n?"":a?"icon-btn":"icon";s=e.active?s+" active":s;var i=t||"";return r.a.createElement("div",{className:"".concat(s," ").concat(c),onClick:o,"data-name":i})},G=a(290),F=a(277),J=Object(g.a)((function(e){return{formInput:{"&:after":{borderBottom:"1px solid #44a2fc"}},required:{fontSize:"12px",color:"#ff0000",lineHeight:"17px",position:"absolute",top:"48px"}}})),z=/^[a-zA-Z0-9]*/,Y=function(e){var t=J();return r.a.createElement(r.a.Fragment,null,r.a.createElement(G.a,null,e.Label),r.a.createElement(F.a,{className:t.formInput,value:e.value,onChange:function(t){var a=t.target.value.match(z)[0];e.onChange(a||"")}}),e.requiredText?r.a.createElement(w.a,{className:t.required},e.requiredText):null)},Z=a(284),K=a(291),q=r.a.memo((function(e){var t=e.value,a=e.onChange,n=e.items;return r.a.createElement(Z.a,{value:t,onChange:a},n.map((function(e,t){return r.a.createElement(K.a,{key:t,value:t},e.text)})))}));console.log("CURRENT RUNTIME: ".concat("web"));var H=r.a.createContext({}),Q=function(){return r.a.useContext(H)},$=function(e){var t=e.children,a=T.a.get(Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_AGORA_APP_ID:"3a1a2513fbd24bd980a411d32f20307d",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_AGORA_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_AGORA_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_AGORA_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_AGORA_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_AGORA_RECORDING_OSS_URL:"oss_url",REACT_APP_AGORA_RECORDING_SERVICE_URL:"https://apiagoraio.herewhite.com",REACT_APP_NETLESS_APP_API_ENTRY:"https://cloudcapiv4.herewhite.com/room?token=",REACT_APP_NETLESS_APP_JOIN_API:"https://cloudcapiv4.herewhite.com/room/join?token=",REACT_APP_NETLESS_APP_TOKEN:"WHITEcGFydG5lcl9pZD0xTnd5aDBsMW9ZazhaRWNuZG1kaWgwcmJjVWVsQnE1UkpPMVMmc2lnPWI5ZGRmNTU1YTgwM2Q0NjFjMDY5YTQ3NDA2ZDMxN2Q5NTVmYTJjYjY6YWRtaW5JZD01MjEmcm9sZT1taW5pJmV4cGlyZV90aW1lPTE2MDM3OTIwOTMmYWs9MU53eWgwbDFvWWs4WkVjbmRtZGloMHJiY1VlbEJxNVJKTzFTJmNyZWF0ZV90aW1lPTE1NzIyMzUxNDEmbm9uY2U9MTU3MjIzNTE0MDY3MTAw",REACT_APP_RUNTIME_PLATFORM:"web"}),"REACT_APP_RUNTIME_PLATFORM","web"),c=Object(s.g)(),o=window.ipc;Object(n.useEffect)((function(){o&&(c.pathname.match(/classroom|replay/)?o.send("resize-window",{width:990,height:706}):o.send("resize-window",{width:700,height:500}))}),[c,o]);var i=function(e){if(o)switch(e){case"minimum":return void o.send("minimum");case"maximum":return void o.send("maximum");case"close":return void o.send("close")}},u={platform:a,NavBtn:function(){return"electron"===a?r.a.createElement("div",{className:"menu-group"},r.a.createElement(V,{className:"icon-minimum",icon:!0,onClick:function(){i("minimum")}}),r.a.createElement(V,{className:"icon-maximum",icon:!0,onClick:function(){i("maximum")}}),r.a.createElement(V,{className:"icon-close",icon:!0,onClick:function(){i("close")}})):null},HomeBtn:function(e){var t=e.handleSetting;return"electron"===a?r.a.createElement(r.a.Fragment,null,r.a.createElement(V,{className:"icon-setting",onClick:t}),r.a.createElement("div",{className:"icon-container"},r.a.createElement(V,{className:"icon-minimum",onClick:function(){i("minimum")}}),r.a.createElement(V,{className:"icon-close",onClick:function(){i("close")}}))):null},SettingBtn:function(){return"electron"===a?r.a.createElement(r.a.Fragment,null,r.a.createElement(V,{className:"icon-minimum",onClick:function(){i("minimum")}}),r.a.createElement(V,{className:"icon-close",onClick:function(){i("close")}})):null}};return r.a.createElement(H.Provider,{value:u},t)},X=a(29),ee=a(3),te=a.n(ee),ae=a(5),ne=a(35),re=a.n(ne),ce=a(70),oe=a.n(ce);oe.a.Logger.enableLogUpload();var se,ie=["accessAllowed","accessDenied","stopScreenSharing","videoTrackEnded","audioTrackEnded","player-status-changed"],ue=["stream-published","stream-added","stream-removed","stream-subscribed","peer-online","peer-leave","error","network-type-changed","network-quality","exception","onTokenPrivilegeWillExpire","onTokenPrivilegeDidExpire"],le="3a1a2513fbd24bd980a411d32f20307d",me=(Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_AGORA_APP_ID:"3a1a2513fbd24bd980a411d32f20307d",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"customer_certificate",REACT_APP_AGORA_CUSTOMER_ID:"customer_id",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_AGORA_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_AGORA_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_AGORA_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_AGORA_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_AGORA_RECORDING_OSS_URL:"oss_url",REACT_APP_AGORA_RECORDING_SERVICE_URL:"https://apiagoraio.herewhite.com",REACT_APP_NETLESS_APP_API_ENTRY:"https://cloudcapiv4.herewhite.com/room?token=",REACT_APP_NETLESS_APP_JOIN_API:"https://cloudcapiv4.herewhite.com/room/join?token=",REACT_APP_NETLESS_APP_TOKEN:"WHITEcGFydG5lcl9pZD0xTnd5aDBsMW9ZazhaRWNuZG1kaWgwcmJjVWVsQnE1UkpPMVMmc2lnPWI5ZGRmNTU1YTgwM2Q0NjFjMDY5YTQ3NDA2ZDMxN2Q5NTVmYTJjYjY6YWRtaW5JZD01MjEmcm9sZT1taW5pJmV4cGlyZV90aW1lPTE2MDM3OTIwOTMmYWs9MU53eWgwbDFvWWs4WkVjbmRtZGloMHJiY1VlbEJxNVJKTzFTJmNyZWF0ZV90aW1lPTE1NzIyMzUxNDEmbm9uY2U9MTU3MjIzNTE0MDY3MTAw",REACT_APP_RUNTIME_PLATFORM:"web"}).REACT_APP_AGORA_APP_TOKEN,function(){function e(){Object(C.a)(this,e),this.streamID=void 0,this._init=!1,this._joined=!1,this._published=!1,this._internalTimer=void 0,this._client=oe.a.createClient({mode:"live",codec:"vp8"}),this._bus=new re.a,this._localStream=null,this._streamEvents=void 0,this._clientEvents=void 0,this.streamID=null,this._streamEvents=[],this._clientEvents=[]}return Object(j.a)(e,[{key:"initClient",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a,n=this;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._init){e.next=2;break}return e.abrupt("return");case 2:return a=new Promise((function(e,a){!1===n._init&&n._client.init(t,(function(){n._init=!0,e()}),a)})),e.next=5,a;case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createClient",value:function(){var e=Object(ae.a)(te.a.mark((function e(t,a){var n=this;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initClient(t);case 2:this.subscribeClientEvents(),a&&(this._internalTimer=setInterval((function(){n._client.getTransportStats((function(e){var t=e.RTT?e.RTT:0;n._bus.emit("watch-rtt",t)}))}),100));case 4:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"destroyClient",value:function(){this.unsubscribeClientEvents()}},{key:"subscribeClientEvents",value:function(){var e,t=this,a=Object(X.a)(ue);try{var n=function(){var a=e.value;t._clientEvents.push(a),t._client.on(a,(function(e){"peer-leave"===a&&console.log("[agora-web] peer-leave: ",e),t._bus.emit(a,e)}))};for(a.s();!(e=a.n()).done;)n()}catch(r){a.e(r)}finally{a.f()}}},{key:"unsubscribeClientEvents",value:function(){var e,t=this,a=Object(X.a)(this._clientEvents);try{var n=function(){var a=e.value;t._client.off(a,(function(){})),t._clientEvents=t._clientEvents.filter((function(e){return e===a}))};for(a.s();!(e=a.n()).done;)n()}catch(r){a.e(r)}finally{a.f()}}},{key:"subscribeLocalStreamEvents",value:function(){var e,t=this,a=Object(X.a)(ie);try{var n=function(){var a=e.value;t._streamEvents.push(a),t._localStream.on(a,(function(e){t._bus.emit(a,e)}))};for(a.s();!(e=a.n()).done;)n()}catch(r){a.e(r)}finally{a.f()}}},{key:"unsubscribeLocalStreamEvents",value:function(){var e=this;if(this._localStream){var t,a=Object(X.a)(this._streamEvents);try{var n=function(){var a=t.value;e._localStream.removeEventListener(a,(function(e){})),e._streamEvents=e._streamEvents.filter((function(e){return e===a}))};for(a.s();!(t=a.n()).done;)n()}catch(r){a.e(r)}finally{a.f()}}}},{key:"renewToken",value:function(e){if(!this._client)return console.warn("renewToken is not permitted, checkout your instance");this._client.renewToken(e)}},{key:"removeAllListeners",value:function(){this.unsubscribeClientEvents(),this._bus.removeAllListeners()}},{key:"on",value:function(e,t){this._bus.on(e,t)}},{key:"off",value:function(e,t){this._bus.off(e,t)}},{key:"publish",value:function(){var e=Object(ae.a)(te.a.mark((function e(){var t=this;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){if(t._published)return e();t._client.publish(t._localStream,(function(e){a(e)})),setTimeout((function(){e(),t._published=!0}),300)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"unpublish",value:function(){var e=Object(ae.a)(te.a.mark((function e(){var t=this;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){if(!t._published||!t._localStream)return e();t._client.unpublish(t._localStream,(function(e){a(e)})),setTimeout((function(){e(),t.destroyLocalStream(),t._published=!1}),300)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setRemoteVideoStreamType",value:function(e,t){this._client.setRemoteVideoStreamType(e,t)}},{key:"enableDualStream",value:function(){var e=Object(ae.a)(te.a.mark((function e(){var t=this;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){t._client.enableDualStream(e,a)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"createLocalStream",value:function(e){var t=this;return this._localStream=oe.a.createStream(Object(p.a)({},e,{mirror:!1})),new Promise((function(a,n){t._localStream.init((function(){t.streamID=e.streamID,t.subscribeLocalStreamEvents(),e.audioOutput&&e.audioOutput.deviceId&&t.setAudioOutput(e.audioOutput.deviceId).then((function(){console.log("setAudioOutput success",e.audioOutput)})).catch((function(e){console.warn("setAudioOutput failed",e,JSON.stringify(e))})),a()}),(function(e){n(e)}))}))}},{key:"destroyLocalStream",value:function(){this.unsubscribeLocalStreamEvents(),this._localStream&&(this._localStream.isPlaying()&&this._localStream.stop(),this._localStream.close()),this._localStream=null,this.streamID=0}},{key:"join",value:function(){var e=Object(ae.a)(te.a.mark((function e(t,a,n){var r=this;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,c){r._client.join(n,a,+t,e,c)})));case 1:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=Object(ae.a)(te.a.mark((function e(){var t=this;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._client){e.next=2;break}return e.abrupt("return",new Promise((function(e,a){t._client.leave(e,a)})));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setAudioOutput",value:function(e){var t=this;return new Promise((function(a,n){t._client.setAudioOutput(e,a,n)}))}},{key:"setAudioVolume",value:function(e){this._client.setAudioVolume(e)}},{key:"subscribe",value:function(e){this._client.subscribe(e,{video:!0,audio:!0},(function(e){console.log("[rtc-client] subscribe failed: ",JSON.stringify(e))}))}},{key:"destroy",value:function(){this._internalTimer&&clearInterval(this._internalTimer),this._internalTimer=null,this.destroyLocalStream()}},{key:"exit",value:function(){var e=Object(ae.a)(te.a.mark((function e(){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.leave();case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),e.t0;case 8:return e.prev=8,e.next=11,this.destroy();case 11:return e.finish(8);case 12:case"end":return e.stop()}}),e,this,[[0,5,8,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"getDevices",value:function(){return new Promise((function(e,t){oe.a.getDevices((function(t){var a=[];t.forEach((function(e){a.push({deviceId:e.deviceId,kind:e.kind,label:e.label})})),e(a)}),(function(e){t(e)}))}))}}]),e}()),de=function(){function e(t){Object(C.a)(this,e),this.rtc=void 0,this.shareClient=void 0,this.localUid=void 0,this.channel=void 0,this.bus=void 0,this.shared=void 0,this.joined=void 0,this.published=void 0,this.tmpStream=void 0,this.roomStore=void 0,this.localUid=0,this.channel="",this.rtc=new me,this.bus=new re.a,this.shared=!1,this.shareClient=null,this.tmpStream=null,this.joined=!1,this.published=!1,this.roomStore=t.roomStore}return Object(j.a)(e,[{key:"getDevices",value:function(){var e=Object(ae.a)(te.a.mark((function e(){var t,a,n,r,c,o,s;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new me,e.prev=1,e.next=4,t.getDevices();case 4:if(a=e.sent,n=a.filter((function(e){return"videoinput"===e.kind})),r=a.filter((function(e){return"audioinput"===e.kind})),n.length){e.next=9;break}throw"cameraList is empty";case 9:if(r.length){e.next=11;break}throw"microphoneList is empty";case 11:return c=n[0].deviceId,o=r[0].deviceId,e.next=15,t.initClient(le);case 15:return s={streamID:0,audio:!0,video:!0,screen:!1,microphoneId:o,cameraId:c},e.next=18,t.createLocalStream(s);case 18:return e.abrupt("return",a);case 21:throw e.prev=21,e.t0=e.catch(1),e.t0;case 24:return e.prev=24,t.destroyLocalStream(),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[1,21,24,27]])})));return function(){return e.apply(this,arguments)}}()},{key:"joinChannel",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a,n,r,c;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.uid,n=t.channel,r=t.dual,c=t.token,this.localUid=a,this.channel=n,e.next=5,this.rtc.createClient(le,!0);case 5:return e.next=7,this.rtc.join(this.localUid,n,c);case 7:if(e.t0=r,!e.t0){e.next=11;break}return e.next=11,this.rtc.enableDualStream();case 11:this.joined=!0,xe.setRTCJoined(!0);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"leaveChannel",value:function(){var e=Object(ae.a)(te.a.mark((function e(){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.localUid=0,this.channel="",e.prev=2,e.next=5,this.unpublishLocalStream();case 5:return e.next=7,this.rtc.leave();case 7:this.joined=!1,xe.setRTCJoined(!1),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(2),e.t0;case 14:return e.prev=14,this.rtc.destroy(),this.rtc.destroyClient(),e.finish(14);case 18:case"end":return e.stop()}}),e,this,[[2,11,14,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"enableDualStream",value:function(){var e=Object(ae.a)(te.a.mark((function e(){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rtc.enableDualStream());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"publishLocalStream",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(" publish local stream ",this.published),!this.published){e.next=5;break}return e.next=4,this.unpublishLocalStream();case 4:console.log("[agora-web] unpublished",this.published);case 5:if(t.cameraId&&t.microphoneId){e.next=11;break}return e.next=8,this.getDevices();case 8:a=e.sent,t.cameraId||(t.cameraId=a.filter((function(e){return"videoinput"===e.kind}))[0].deviceId),t.microphoneId||(t.microphoneId=a.filter((function(e){return"audioinput"===e.kind}))[0].deviceId);case 11:return e.next=13,this.rtc.createLocalStream(t);case 13:return e.next=15,this.rtc.publish();case 15:this.published=!0;case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unpublishLocalStream",value:function(){var e=Object(ae.a)(te.a.mark((function e(){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[agora-web] invoke unpublishStream"),e.next=3,this.rtc.unpublish();case 3:this.published=!1;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startScreenShare",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.shareClient=new me,e.next=3,this.shareClient.createLocalStream({video:!1,audio:!1,screen:!0,screenAudio:!0,streamID:7,microphoneId:"",cameraId:""});case 3:return e.next=5,this.shareClient.createClient(le);case 5:return e.next=7,this.shareClient.join(7,this.channel,t);case 7:return e.next=9,this.shareClient.publish();case 9:this.shared=!0;case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"start3dViewerShare",value:function(){var e=Object(ae.a)(te.a.mark((function e(t,a){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.shareClient=new me,e.next=3,this.shareClient.createLocalStream({video:!0,audio:!1,videoSource:a.getVideoTracks()[0],streamID:7});case 3:return e.next=5,this.shareClient.createClient(le);case 5:return e.next=7,this.shareClient.join(7,this.channel,t);case 7:return e.next=9,this.shareClient.publish();case 9:this.shared=!0;case 10:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"stopScreenShare",value:function(){var e=Object(ae.a)(te.a.mark((function e(){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.shareClient.unpublish();case 2:return e.next=4,this.shareClient.leave();case 4:return e.next=6,this.shareClient.destroy();case 6:return e.next=8,this.shareClient.destroyClient();case 8:xe.removeLocalSharedStream(),this.shared=!1;case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"exit",value:function(){var e=Object(ae.a)(te.a.mark((function e(){var t;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.next=4,this.leaveChannel();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),t.push({rtcClient:e.t0});case 9:if(!0!==this.shared){e.next=20;break}return e.prev=10,e.next=13,this.shareClient.unpublish();case 13:return e.next=15,this.shareClient.leave();case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(10),t.push({shareClient:e.t1});case 20:if(!this.shareClient){e.next=31;break}return e.prev=21,e.next=24,this.shareClient.destroy();case 24:return e.next=26,this.shareClient.destroyClient();case 26:e.next=31;break;case 28:e.prev=28,e.t2=e.catch(21),t.push({shareClient:e.t2});case 31:if(Object(S.isEmpty)(t)){e.next=33;break}throw t;case 33:case"end":return e.stop()}}),e,this,[[1,6],[10,17],[21,28]])})));return function(){return e.apply(this,arguments)}}()},{key:"createPreviewStream",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a,n,r,c,o=this;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.cameraId,n=t.microphoneId,r=t.speakerId,c=oe.a.createStream({video:!0,audio:!0,screen:!1,cameraId:a,microphoneId:n,speakerId:r}),this.tmpStream&&(this.tmpStream.isPlaying()&&this.tmpStream.stop(),this.tmpStream.close()),e.abrupt("return",new Promise((function(e,t){c.init((function(){o.tmpStream=c,e(c)}),(function(e){t(e)}))})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"subscribe",value:function(e){this.rtc.subscribe(e)}},{key:"setRemoteVideoStreamType",value:function(e,t){this.rtc.setRemoteVideoStreamType(e,t)}}]),e}(),he=a(88),fe=a.n(he),pe=fe.a.LOG_FILTER_DEBUG;!function(e){e[e.muteAudio=101]="muteAudio",e[e.unmuteAudio=102]="unmuteAudio",e[e.muteVideo=103]="muteVideo",e[e.unmuteVideo=104]="unmuteVideo",e[e.applyCoVideo=105]="applyCoVideo",e[e.acceptCoVideo=106]="acceptCoVideo",e[e.rejectCoVideo=107]="rejectCoVideo",e[e.cancelCoVideo=108]="cancelCoVideo",e[e.muteChat=109]="muteChat",e[e.unmuteChat=110]="unmuteChat",e[e.muteBoard=200]="muteBoard",e[e.unmuteBoard=201]="unmuteBoard"}(se||(se={}));var ve=function(){function e(){Object(C.a)(this,e),this._bus=void 0,this._currentChannel=void 0,this._currentChannelName=void 0,this._channels=void 0,this._client=void 0,this._channelAttrsKey=void 0,this._logged=!1,this._joined=!1,this._bus=new re.a,this._channels={},this._currentChannel=null,this._currentChannelName=null,this._channelAttrsKey=null,this._client=fe.a.createInstance("3a1a2513fbd24bd980a411d32f20307d",{enableLogUpload:!0,logFilter:pe})}return Object(j.a)(e,[{key:"removeAllListeners",value:function(){this._bus.removeAllListeners()}},{key:"destroy",value:function(){for(var e=0,t=Object.keys(this._channels);e<t.length;e++){var a=t[e];this._channels[a]&&(this._channels[a].removeAllListeners(),this._channels[a]=null)}this._currentChannel=null,this._currentChannelName=null,this._client.removeAllListeners()}},{key:"on",value:function(e,t){this._bus.on(e,t)}},{key:"off",value:function(e,t){this._bus.off(e,t)}},{key:"login",value:function(){var e=Object(ae.a)(te.a.mark((function e(t,a){var n=this;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._client.login({uid:t,token:a});case 2:return this._client.on("ConnectionStateChanged",(function(e,t){n._bus.emit("ConnectionStateChanged",{newState:e,reason:t})})),this._client.on("MessageFromPeer",(function(e,t,a){n._bus.emit("MessageFromPeer",{message:e,peerId:t,props:a})})),this._logged=!0,e.abrupt("return");case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(ae.a)(te.a.mark((function e(){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logged){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._client.logout();case 4:return this.destroy(),this._logged=!1,e.abrupt("return");case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"join",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a,n=this;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this._client.createChannel(t),this._channels[t]=a,this._currentChannel=this._channels[t],this._currentChannelName=t,e.next=6,a.join();case 6:return a.on("ChannelMessage",(function(e,t){n._bus.emit("ChannelMessage",{message:e,memberId:t})})),a.on("MemberJoined",(function(e){n._bus.emit("MemberJoined",e)})),a.on("MemberLeft",(function(e){n._bus.emit("MemberLeft",e)})),a.on("MemberCountUpdated",(function(e){n._bus.emit("MemberCountUpdated",e)})),a.on("AttributesUpdated",(function(e){n._bus.emit("AttributesUpdated",e)})),this._joined=!0,e.abrupt("return");case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"destroyChannel",value:function(e){this._channels[e]&&(this._channels[e].removeAllListeners(),this._channels[e]=null)}},{key:"leave",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._channels[t]&&(this._joined=!1,this.destroyChannel(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"exit",value:function(){var e=Object(ae.a)(te.a.mark((function e(){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.deleteChannelAttributesByKey();case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:return e.prev=7,e.next=10,this.leave(this._currentChannelName);case 10:return e.next=12,this.logout();case 12:return e.finish(7);case 13:case"end":return e.stop()}}),e,this,[[0,5,7,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"sendChannelMessage",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._currentChannel.sendMessage({text:t},{enableHistoricalMessaging:!0}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateChannelAttrsByKey",value:function(){var e=Object(ae.a)(te.a.mark((function e(t,a){var n;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._channelAttrsKey=t,n={},t&&(n[t]=JSON.stringify(a)),console.log("[rtm-client] updateChannelAttrsByKey ",a," key ",t,n),e.next=6,this._client.addOrUpdateChannelAttributes(this._currentChannelName,n,{enableNotificationToChannelMembers:!0});case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKey",value:function(){var e=Object(ae.a)(te.a.mark((function e(){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._channelAttrsKey){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._client.deleteChannelAttributesByKeys(this._currentChannelName,[this._channelAttrsKey],{enableNotificationToChannelMembers:!0});case 4:return this._channelAttrsKey=null,e.abrupt("return");case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChannelAttrs",value:function(){var e=Object(ae.a)(te.a.mark((function e(){var t;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._client.getChannelAttributes(this._currentChannelName);case 2:return t=e.sent,e.abrupt("return",JSON.stringify(t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._client.getChannelMemberCount(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryOnlineStatusBy",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a,n,r;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={teacherCount:0,totalCount:0,studentTotalCount:0},!(t.length>0)){e.next=7;break}return n=t.map((function(e){return"".concat(e.uid)})),e.next=5,this._client.queryPeersOnlineStatus(n);case 5:(a=e.sent)&&Object.keys(a).length?((r=t.find((function(e){return"teacher"===e.role})))&&a[r.uid]&&(a.teacher=a[r.uid],a.teacherCount=1),a.totalCount=t.filter((function(e){return a[e.uid]})).length,a.studentsTotalCount=a.totalCount-a.teacherCount):console.warn("accounts: ".concat(n,", cannot get peers online status from [queryPeersOnlineStatus]"));case 7:return e.abrupt("return",a);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributeBy",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a,n,r,c,o,s,i;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._client.getChannelAttributes(t);case 2:a=e.sent,n=[],r=0,c=Object.keys(a);case 5:if(!(r<c.length)){e.next=16;break}if("teacher"!==(o=c[r])){e.next=11;break}return(s=Ee(S.get(a,"".concat(o,".value"))))&&Object.keys(s).length&&n.push(Object(p.a)({role:"teacher"},s)),e.abrupt("continue",13);case 11:(i=Ee(S.get(a,"".concat(o,".value"))))&&Object.keys(i).length&&(i.uid=o,n.push(i));case 13:r++,e.next=5;break;case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendPeerMessage",value:function(){var e=Object(ae.a)(te.a.mark((function e(t,a){var n;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _e(t,a),console.log("[rtm-client] send peer message ",t,JSON.stringify(a)),e.next=4,this._client.sendMessageToPeer({text:JSON.stringify(a)},t,{enableHistoricalMessaging:!0});case 4:return n=e.sent,e.abrupt("return",n.hasPeerReceived);case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()}]),e}();function be(e){var t="".concat("oss_url","/").concat(e);return console.log("resolve: ",t,"oss_url"),t}var ge=function(e){switch(e){case"CN_Hangzhou":case"oss-cn-hangzhou":return 0;case"CN_Shanghai":case"oss-cn-shanghai":return 1;case"CN_Qingdao":case"oss-cn-qingdao":return 2;case"CN_Beijin":case"oss-cn-beijing":return 3;case"CN_Zhangjiakou":case"oss-cn-zhangjiakou":return 4;case"CN_Huhehaote":case"oss-cn-huhehaote":return 5;case"CN_Shenzhen":case"oss-cn-shenzhen":return 6;case"CN_Hongkong":case"oss-cn-hongkong":return 7;case"US_West_1":case"oss-us-west-1":return 8;case"US_East_1":case"oss-us-east-1":return 9;case"AP_Southeast_1":case"oss-ap-southeast-1":return 10;case"AP_Southeast_2":case"oss-ap-southeast-2":return 11;case"AP_Southeast_3":case"oss-ap-southeast-3":return 12;case"AP_Southeast_5":case"oss-ap-southeast-5":return 13;case"AP_Northeast_1":case"oss-ap-northeast-1":return 14;case"AP_South_1":case"oss-ap-south-1":return 15;case"EU_Central_1":case"oss-eu-central-1":return 16;case"EU_West_1":case"oss-eu-west-1":return 17;case"EU_East_1":case"oss-me-east-1":return 18;default:return 0}};function _e(e,t){var a=t.cmd,n=(t.text,"");switch(a){case se.acceptCoVideo:n="accept co-video";break;case se.rejectCoVideo:n="reject co-video";break;case se.cancelCoVideo:n="cancel co-video";break;case se.applyCoVideo:n="apply co-video";break;case se.muteVideo:n="mute video";break;case se.muteAudio:n="mute audio";break;case se.unmuteAudio:n="unmute audio";break;case se.unmuteVideo:n="unmute video";break;default:return console.warn("[RoomMessage] unknown type, from peerId: ".concat(e))}console.log("[RoomMessage] [".concat(n,"] from peerId: ").concat(e))}function Ee(e){try{return JSON.parse(e)}catch(t){return{}}}var ye=["unknown","excellent","good","poor","bad","very bad","down"];function ke(e){var t=Math.max(e.downlinkNetworkQuality,e.uplinkNetworkQuality);return ye[t]?ye[t]:"unknown"}var Oe=window.rtcEngine;Oe&&(Oe.initialize(le),Oe.setChannelProfile(1),Oe.enableVideo(),Oe.enableAudio(),Oe.enableWebSdkInteroperability(!0),Oe.setVideoProfile(43,!1));var we;!function(e){e[e.local=0]="local",e[e.remote=1]="remote",e[e.localVideoSource=2]="localVideoSource",e[e.remoteVideoSource=3]="remoteVideoSource"}(we||(we={}));var Ce=a(51);function je(e){var t=e.onlineStatus,a=e.roomType,n=e.channelCount,r=e.role,c={permitted:!0,reason:""},o=[2,17,1/0][a];if(n>=o)return c.permitted=!1,c.reason=U("toast.teacher_and_student_over_limit"),c;var s=Object(S.get)(t,"teacher",!1),i=Object(S.get)(t,"studentsTotalCount",0);if("teacher"===r&&s)return c.permitted=!1,c.reason=U("toast.teacher_exists"),c;return"student"===r&&i>=o-1?(c.permitted=!1,c.reason=U("toast.student_over_limit"),c):c}var xe=new(function(){function e(){Object(C.a)(this,e),this.subject=void 0,this._state=void 0,this.defaultState=Object.freeze(Object(p.a)({rtmLock:!1,rtcToken:"",rtmToken:"",me:{account:"",uid:"",role:"",video:1,audio:1,chat:1,linkId:0,sharedId:0,boardId:"",lockBoard:0,grantBoard:0},users:Object(Ce.b)(),applyUid:0,rtm:{joined:!1,memberCount:0},rtc:{published:!1,joined:!1,shared:!1,users:Object(Ce.c)(),localStream:null,localSharedStream:null,remoteStreams:Object(Ce.b)()},course:{teacherId:"",boardId:"",sharedId:0,linkId:0,courseState:0,muteChat:0,rid:"",roomName:"",roomType:0,lockBoard:0},mediaDevice:{microphoneId:"",speakerId:"",cameraId:"",speakerVolume:100,camera:0,speaker:0,microphone:0},messages:Object(Ce.a)(),language:navigator.language},P.read("agora_room"))),this.applyLock=0,this.windowId=0,this.rtmClient=void 0,this.rtcClient=void 0,this.subject=null,this._state=Object(p.a)({},this.defaultState),this.rtmClient=new ve,this.rtcClient=new de({roomStore:this})}return Object(j.a)(e,[{key:"state",get:function(){return this._state},set:function(e){this._state=e}}]),Object(j.a)(e,[{key:"initialize",value:function(){this.subject=new x.a,this.state=Object(p.a)({},this.defaultState),this.applyLock=0,this.subject.next(this.state)}},{key:"subscribe",value:function(e){this.initialize(),this.subject&&this.subject.subscribe(e)}},{key:"unsubscribe",value:function(){this.subject&&this.subject.unsubscribe(),this.subject=null}},{key:"commit",value:function(e){this.subject&&this.subject.next(e)}},{key:"updateState",value:function(e){this.state=Object(p.a)({},this.state,{},e),this.commit(this.state)}},{key:"isTeacher",value:function(e){return!(!e||!this.state.course.teacherId||this.state.course.teacherId!==e)}},{key:"isStudent",value:function(e){return!(!e||this.state.course.teacherId===e)}},{key:"addLocalStream",value:function(e){this.state=Object(p.a)({},this.state,{rtc:Object(p.a)({},this.state.rtc,{localStream:e})}),this.commit(this.state)}},{key:"removeLocalStream",value:function(){this.state=Object(p.a)({},this.state,{rtc:Object(p.a)({},this.state.rtc,{localStream:null,localSharedStream:null})}),this.commit(this.state)}},{key:"addLocalSharedStream",value:function(e){this.state=Object(p.a)({},this.state,{rtc:Object(p.a)({},this.state.rtc,{localSharedStream:e})}),this.commit(this.state)}},{key:"removeLocalSharedStream",value:function(){this.state=Object(p.a)({},this.state,{rtc:Object(p.a)({},this.state.rtc,{localSharedStream:null})}),this.commit(this.state)}},{key:"addPeerUser",value:function(e){this.state=Object(p.a)({},this.state,{rtc:Object(p.a)({},this.state.rtc,{users:this.state.rtc.users.add(e)})}),this.commit(this.state)}},{key:"removePeerUser",value:function(e){this.state=Object(p.a)({},this.state,{rtc:Object(p.a)({},this.state.rtc,{users:this.state.rtc.users.delete(e)})}),this.commit(this.state)}},{key:"addRemoteStream",value:function(e){this.state=Object(p.a)({},this.state,{rtc:Object(p.a)({},this.state.rtc,{remoteStreams:this.state.rtc.remoteStreams.set(e.streamID,e)})}),this.commit(this.state)}},{key:"removeRemoteStream",value:function(e){var t=this.state.rtc.remoteStreams.get(e);t&&t.stream&&t.stream.isPlaying&&t.stream.isPlaying()&&t.stream.stop(),this.state=Object(p.a)({},this.state,{rtc:Object(p.a)({},this.state.rtc,{remoteStreams:this.state.rtc.remoteStreams.delete(e)})}),this.commit(this.state)}},{key:"updateMemberCount",value:function(e){this.state=Object(p.a)({},this.state,{rtm:Object(p.a)({},this.state.rtm,{memberCount:e})}),this.commit(this.state)}},{key:"updateRtc",value:function(e){this.state=Object(p.a)({},this.state,{rtc:Object(p.a)({},this.state.rtc,{},e)}),this.commit(this.state)}},{key:"updateDevice",value:function(e){this.state=Object(p.a)({},this.state,{mediaDevice:e}),this.commit(this.state)}},{key:"handlePeerMessage",value:function(){var e=Object(ae.a)(te.a.mark((function e(t,a){var n,r;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return",console.warn("state is not assigned"));case 2:if(n=this.state.me.uid,console.log("Teacher: ",this.isTeacher(n),", peerId: ",this.isStudent(a)),this.isTeacher(n)||!this.isTeacher(a)){e.next=42;break}this.state.me,e.t0=t,e.next=e.t0===se.muteChat?9:e.t0===se.muteAudio?12:e.t0===se.muteVideo?15:e.t0===se.muteBoard?18:e.t0===se.unmuteAudio?22:e.t0===se.unmuteVideo?25:e.t0===se.unmuteChat?28:e.t0===se.unmuteBoard?31:e.t0===se.acceptCoVideo?35:e.t0===se.rejectCoVideo?37:e.t0===se.cancelCoVideo?39:41;break;case 9:return e.next=11,this.updateMe({chat:0});case 11:return e.abrupt("return",e.sent);case 12:return e.next=14,this.updateMe({audio:0});case 14:return e.abrupt("return",e.sent);case 15:return e.next=17,this.updateMe({video:0});case 17:return e.abrupt("return",e.sent);case 18:return I.showToast({type:"notice",message:U("toast.teacher_cancel_whiteboard")}),e.next=21,this.updateMe({grantBoard:0});case 21:return e.abrupt("return",e.sent);case 22:return e.next=24,this.updateMe({audio:1});case 24:return e.abrupt("return",e.sent);case 25:return e.next=27,this.updateMe({video:1});case 27:return e.abrupt("return",e.sent);case 28:return e.next=30,this.updateMe({chat:1});case 30:return e.abrupt("return",e.sent);case 31:return I.showToast({type:"notice",message:U("toast.teacher_accept_whiteboard")}),e.next=34,this.updateMe({grantBoard:1});case 34:return e.abrupt("return",e.sent);case 35:return I.showToast({type:"co-video",message:U("toast.teacher_accept_co_video")}),e.abrupt("return");case 37:return I.showToast({type:"co-video",message:U("toast.teacher_reject_co_video")}),e.abrupt("return");case 39:return I.showToast({type:"co-video",message:U("toast.teacher_cancel_co_video")}),e.abrupt("return");case 41:return e.abrupt("return");case 42:if(!this.isTeacher(n)||!this.isStudent(a)){e.next=54;break}e.t1=t,e.next=e.t1===se.applyCoVideo?46:e.t1===se.cancelCoVideo?51:53;break;case 46:if(!this.state.course.linkId){e.next=48;break}return e.abrupt("return",console.warn("already received apply id: ",this.applyLock));case 48:return(r=xe.state.users.get("".concat(a)))&&(this.applyLock=+a,console.log("applyUid: ",this.applyLock),this.state=Object(p.a)({},this.state,{applyUid:this.applyLock}),this.commit(this.state),I.showNotice({reason:"peer_hands_up",text:U("notice.student_interactive_apply",{reason:r.account})})),e.abrupt("return");case 51:return this.state.course.linkId&&"".concat(this.state.course.linkId)===a&&(xe.updateCourseLinkUid(0).then((function(){})).catch(console.warn),I.showToast({type:"co-video",message:U("toast.student_cancel_co_video")})),e.abrupt("return");case 53:return e.abrupt("return");case 54:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"mute",value:function(){var e=Object(ae.a)(te.a.mark((function e(t,a){var n;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.state.me).uid!=="".concat(t)){e.next=13;break}if("audio"!==a){e.next=5;break}return e.next=5,this.updateMe({audio:0});case 5:if("video"!==a){e.next=8;break}return e.next=8,this.updateMe({video:0});case 8:if("chat"!==a){e.next=11;break}return e.next=11,this.updateMe({chat:0});case 11:e.next=26;break;case 13:if("teacher"!==n.role){e.next=26;break}if("audio"!==a){e.next=17;break}return e.next=17,this.rtmClient.sendPeerMessage("".concat(t),{cmd:se.muteAudio});case 17:if("video"!==a){e.next=20;break}return e.next=20,this.rtmClient.sendPeerMessage("".concat(t),{cmd:se.muteVideo});case 20:if("chat"!==a){e.next=23;break}return e.next=23,this.rtmClient.sendPeerMessage("".concat(t),{cmd:se.muteChat});case 23:if("grantBoard"!==a){e.next=26;break}return e.next=26,this.rtmClient.sendPeerMessage("".concat(t),{cmd:se.muteBoard});case 26:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"unmute",value:function(){var e=Object(ae.a)(te.a.mark((function e(t,a){var n;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.state.me).uid!=="".concat(t)){e.next=13;break}if("audio"!==a){e.next=5;break}return e.next=5,this.updateMe({audio:1});case 5:if("video"!==a){e.next=8;break}return e.next=8,this.updateMe({video:1});case 8:if("chat"!==a){e.next=11;break}return e.next=11,this.updateMe({chat:1});case 11:e.next=26;break;case 13:if("teacher"!==n.role){e.next=26;break}if("audio"!==a){e.next=17;break}return e.next=17,this.rtmClient.sendPeerMessage("".concat(t),{cmd:se.unmuteAudio});case 17:if("video"!==a){e.next=20;break}return e.next=20,this.rtmClient.sendPeerMessage("".concat(t),{cmd:se.unmuteVideo});case 20:if("chat"!==a){e.next=23;break}return e.next=23,this.rtmClient.sendPeerMessage("".concat(t),{cmd:se.unmuteChat});case 23:if("grantBoard"!==a){e.next=26;break}return e.next=26,this.rtmClient.sendPeerMessage("".concat(t),{cmd:se.unmuteBoard});case 26:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"loginAndJoin",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a,n,r,c,o,s,i,u,l,m,d,h,f,v=arguments;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>1&&void 0!==v[1]&&v[1],n=t.roomType,r=t.role,c=t.uid,o=t.rid,s=t.rtmToken,console.log("payload: ",t),i={permitted:!0,reason:""},e.next=6,this.rtmClient.login(c,s);case 6:return e.prev=6,e.next=9,this.rtmClient.getChannelMemberCount([o]);case 9:return u=e.sent,l=u[o],e.next=13,this.rtmClient.getChannelAttributeBy(o);case 13:return m=e.sent,e.next=16,this.rtmClient.queryOnlineStatusBy(m);case 16:if(d=e.sent,console.log("onlineStatus",d),h={channelCount:l,onlineStatus:d,role:r,accounts:m,roomType:n},!(i=!1===a?je(h):{permitted:!0,reason:""}).permitted){e.next=31;break}return e.next=23,this.rtmClient.join(o);case 23:return e.sent,f="teacher"===r?1:0,e.next=27,this.updateMe(Object(p.a)({},t,{grantBoard:f}));case 27:return this.state=Object(p.a)({},this.state,{rtm:Object(p.a)({},this.state.rtm,{joined:!0})}),console.log("loginAndJoin>>>>: accounts",m),this.commit(this.state),e.abrupt("return");case 31:throw{type:"not_permitted",reason:i.reason};case 34:if(e.prev=34,e.t0=e.catch(6),!this.rtmClient._logged){e.next=39;break}return e.next=39,this.rtmClient.logout();case 39:throw e.t0;case 40:case"end":return e.stop()}}),e,this,[[6,34]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setRTCJoined",value:function(e){this.state=Object(p.a)({},this.state,{rtc:Object(p.a)({},this.state.rtc,{joined:e})}),this.commit(this.state)}},{key:"updateCourseLinkUid",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a,n;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.state.me,console.log("me: link_uid",a,t),e.next=4,this.updateMe({linkId:t});case 4:return n=e.sent,this.applyLock=t,console.log("current apply lock: ",this.applyLock),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateWhiteboardUid",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateMe({boardId:t});case 2:return a=e.sent,console.log("[update whiteboard uuid] res",t),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateChannelMessage",value:function(e){this.state=Object(p.a)({},this.state,{messages:this.state.messages.push(e)}),this.commit(this.state)}},{key:"compositeMe",value:function(e){console.log("compositeMe: ",e);var t=Object(p.a)({},this.state.me);for(var a in e)t.hasOwnProperty(a)&&e.hasOwnProperty(a)&&Object(S.set)(t,a,Object(S.get)(e,a,""));return t}},{key:"compositeCourse",value:function(e){console.log("compositeCourse: ",e);var t=Object(p.a)({},this.state.course);for(var a in e)t.hasOwnProperty(a)&&e.hasOwnProperty(a)&&Object(S.set)(t,a,Object(S.get)(e,a,""));return t}},{key:"exactChannelAttrsBy",value:function(e,t){console.log("origin: ",e,t);var a={uid:e.uid,account:"".concat(e.account),role:"".concat(e.role),video:+e.video,audio:+e.audio,chat:+e.chat,whiteboard_uid:e.boardId,shared_uid:e.sharedId,link_uid:+e.linkId,lock_board:+e.lockBoard,grant_board:+e.grantBoard};return!t.boardId&&e.boardId&&(a.whiteboard_uid=e.boardId),"teacher"===e.role&&(a.lock_board=t.lockBoard,a.class_state=t.courseState,a.mute_chat=t.muteChat),a}},{key:"updateMe",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a,n,r,c,o,s,i;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.compositeMe(t),n=this.compositeCourse(t),r=a.role,c=a.uid,o="teacher"===r?"teacher":"".concat(c),"teacher"===r&&(n.teacherId=c),s=this.exactChannelAttrsBy(a,n),this.state=Object(p.a)({},this.state,{me:Object(p.a)({},a),users:this.state.users.set(a.uid,Object(p.a)({},a)),course:Object(p.a)({},n)}),this.commit(this.state),e.next=10,this.rtmClient.updateChannelAttrsByKey(o,s);case 10:return i=e.sent,e.abrupt("return",i);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"exactChannelAttrsFrom",value:function(e){var t={class_state:0,link_uid:0,shared_uid:0,mute_chat:0,whiteboard_uid:0,lock_board:0},a=["uid","account","role","video","audio","chat","whiteboard_uid","shared_uid","mute_chat","link_uid","class_state","grant_board","lock_board"],n=Ee(Object(S.get)(e,"teacher.value")),r={};if(n)for(var c in n)t.hasOwnProperty(c)&&(r[c]=n[c]);for(var o=[],s=0,i=Object.keys(e);s<i.length;s++){var u=i[s];if("teacher"!==u){var l=Ee(Object(S.get)(e,"".concat(u,".value")));Object(S.isEmpty)(l)||(l.uid=u,o.push(Object.freeze(l)))}}var m=[];if(!Object(S.isEmpty)(n)){var d,h={role:"teacher"},f=Object(X.a)(a);try{for(f.s();!(d=f.n()).done;){var p=d.value;n.hasOwnProperty(p)&&(h[p]=n[p])}}catch(O){f.e(O)}finally{f.f()}m.push(h)}for(var v=0,b=o;v<b.length;v++){var g=b[v];if(!Object(S.isEmpty)(g)){var _,E={role:"student"},y=Object(X.a)(a);try{for(y.s();!(_=y.n()).done;){var k=_.value;g.hasOwnProperty(k)&&(E[k]=g[k])}}catch(O){y.e(O)}finally{y.f()}m.push(E)}}return{teacher:n,students:o,accounts:m,course:r}}},{key:"updateRoomAttrs",value:function(e){var t=this.exactChannelAttrsFrom(e),a=t.teacher,n=t.accounts,r=t.course;console.log("origin",e),console.log("origin exact",a,n,r);var c=n.reduce((function(e,t){return e.set(t.uid,{role:t.role,account:t.account,uid:t.uid,video:t.video,audio:t.audio,chat:t.chat,boardId:t.whiteboard_uid,sharedId:t.shared_uid,linkId:t.link_uid,lockBoard:t.lock_board,grantBoard:t.grant_board})}),Object(Ce.b)()),o={teacherId:Object(S.get)(a,"uid",0),linkId:r.link_uid,boardId:r.whiteboard_uid,courseState:r.class_state,muteChat:r.mute_chat,lockBoard:r.lock_board},s=this.state.me,i={};i=c.get(s.uid)?c.get(s.uid):s;var u=this.compositeMe(i);c.set(u.uid,Object(p.a)({},u));var l=this.compositeCourse(o);this.state=Object(p.a)({},this.state,{users:c,me:Object(p.a)({},this.state.me,{},u),course:Object(p.a)({},this.state.course,{},l)}),this.commit(this.state)}},{key:"exitAll",value:function(){var e=Object(ae.a)(te.a.mark((function e(){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.prev=1,e.next=4,this.rtmClient.exit();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.warn(e.t0);case 9:return e.prev=9,e.next=12,this.rtcClient.exit();case 12:e.next=17;break;case 14:e.prev=14,e.t1=e.catch(9),console.warn(e.t1);case 17:return e.prev=17,P.clear("agora_room"),this.state=Object(p.a)({},this.defaultState),this.commit(this.state),e.finish(17);case 22:case"end":return e.stop()}}),e,this,[[0,,17,22],[1,6],[9,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"setScreenShare",value:function(e){Object(p.a)({},this.state.rtc,{published:!0});this.state=Object(p.a)({},this.state,{rtc:Object(p.a)({},this.state.rtc,{shared:e})}),this.commit(this.state)}},{key:"applyUid",get:function(){return this.applyLock}}]),e}());window.roomStore=xe;var Se=a(76),Te=a.n(Se),Ne=Object(g.a)((function(e){return{formControl:{minWidth:"240px",maxWidth:"240px"}}})),Pe={roomName:"",roomType:0,role:"",yourName:""};var Ae=r.a.memo((function(){document.title=U("home.short_title.title");var e=Ne(),t=Object(s.f)(),a=function(e){t.push({pathname:"/device_test"})},c=Q().HomeBtn,o=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){o.current=!0}}),[]);var i=Object(n.useState)(Pe),u=Object(v.a)(i,2),l=u[0],m=u[1],d=Object(n.useState)({}),h=Object(v.a)(d,2),f=h[0],g=h[1];return r.a.createElement("div",{className:"flex-container ".concat("home-cover-web")},r.a.createElement("div",{className:"web-menu"},r.a.createElement("div",{className:"web-menu-container"},r.a.createElement("div",{className:"short-title"},r.a.createElement("span",{className:"title"},U("home.short_title.title")),r.a.createElement("span",{className:"subtitle"},U("home.short_title.subtitle")),r.a.createElement("span",{className:"build-version"},U("build_version"))),r.a.createElement("div",{className:"setting-container"},r.a.createElement(V,{className:"icon-setting",onClick:a}),r.a.createElement(q,{value:P.getLanguage().language.match(/^zh/)?0:1,onChange:function(e){0===e.target.value?I.setLanguage("zh-CN"):I.setLanguage("en")},items:[{text:"\u4e2d\u6587",name:"zh-CN"},{text:"En",name:"en"}]})))),r.a.createElement("div",{className:"custom-card"},r.a.createElement("div",{className:"flex-item card"},r.a.createElement("div",{className:"position-top card-menu"},r.a.createElement(c,{handleSetting:a})),r.a.createElement("div",{className:"position-content flex-direction-column"},r.a.createElement(b.a,{className:e.formControl},r.a.createElement(Y,{Label:U("home.room_name"),value:l.roomName,onChange:function(e){m(Object(p.a)({},l,{roomName:e}))},requiredText:f.roomName})),r.a.createElement(b.a,{className:e.formControl},r.a.createElement(Y,{Label:U("home.nickname"),value:l.yourName,onChange:function(e){m(Object(p.a)({},l,{yourName:e}))},requiredText:f.yourName})),r.a.createElement(b.a,{className:e.formControl},r.a.createElement(B,{value:l.role,onChange:function(e){m(Object(p.a)({},l,{role:e.target.value}))},requiredText:f.role})),r.a.createElement(E,{name:U("home.room_join"),onClick:function(){if(l.roomName)if(l.yourName)if(l.role){if(A[l.roomType]){var e=A[l.roomType].path,a={uid:(+Date.now()%1e6).toString(),rid:"".concat(l.roomType).concat(Te()(l.roomName)),role:l.role,roomName:l.roomName,roomType:l.roomType,video:1,audio:1,chat:1,account:l.yourName,rtmToken:"",boardId:"",linkId:0,sharedId:0,lockBoard:0,grantBoard:0};o.current=!0,I.showLoading(),xe.loginAndJoin(a).then((function(){t.push("/classroom/".concat(e))})).catch((function(e){e.reason?I.showToast({type:"rtmClient",message:U("toast.rtm_login_failed_reason",{reason:e.reason})}):I.showToast({type:"rtmClient",message:U("toast.rtm_login_failed")}),console.warn(e)})).finally((function(){o.current=!1,I.stopLoading()}))}}else g(Object(p.a)({},f,{role:U("home.missing_role")}));else g(Object(p.a)({},f,{yourName:U("home.missing_your_name")}));else g(Object(p.a)({},f,{roomName:U("home.missing_room_name")}))}})))))})),Ie=r.a.memo((function(e){var t=e.Label,a=e.value,n=e.onChange,c=e.items;return r.a.createElement(r.a.Fragment,null,r.a.createElement(G.a,null,t),r.a.createElement(Z.a,{value:a,onChange:n},c.map((function(e,t){return r.a.createElement(K.a,{key:t,value:t},e.text)}))))})),Re=a(288),Me=(a(111),Object(g.a)({root:{display:"flex",marginTop:"8px"},sliderClass:{color:"#44A2FC",minWidth:"210px",marginLeft:"6px"}}));function De(e){var t=Me(e),a=r.a.useState(e.volume),c=Object(v.a)(a,2),o=c[0],s=c[1];return Object(n.useEffect)((function(){e.onChange(o)}),[o]),r.a.createElement("div",{className:"volume-container"},r.a.createElement("div",{className:t.root},r.a.createElement(V,{className:"icon-speaker",disable:!0}),r.a.createElement(Re.a,{className:t.sliderClass,value:o,onChange:function(e,t){s(t)},"aria-labelledby":"continuous-slider"})))}var Le=a(23),Ue=Object(g.a)({root:{display:"flex",marginTop:"8px"},sliderClass:{color:"#44A2FC",minWidth:"210px",marginLeft:"6px"},sliderRailClass:{height:"12px",color:"#44A2FC"},sliderMarkClass:{height:"12px",color:"#CCCCCC"}});function We(e){return r.a.createElement("div",{className:"voice-sliders"},Object(Le.a)(Array(52)).map((function(t,a){return r.a.createElement("span",{className:e.volume>a?"active":"",key:a})})))}function Be(e){var t=Ue(e),a=e.volume;return r.a.createElement("div",{className:t.root},r.a.createElement(V,{className:"icon-voice",disable:!0}),r.a.createElement(We,{volume:52*a,className:t.sliderClass}))}var Ve=function(e){return r.a.createElement("div",{className:"volume-container"},r.a.createElement(Be,{volume:e.volume}))},Ge=(a(165),a(280)),Fe=new(function(){function e(){Object(C.a)(this,e),this.defaultState={reason:null,errors:[]},this.subject=new Ge.a(this.defaultState),console.log("defaultValue",this.subject.getValue())}return Object(j.a)(e,[{key:"subscribe",value:function(e){this.subject.subscribe(e)}},{key:"unsubscribe",value:function(){this.subject.unsubscribe(),this.state=this.defaultState}},{key:"state",set:function(e){this.subject.next(Object(p.a)({},this.subject.getValue(),{},e))},get:function(){return this.subject.getValue()}}]),e}()),Je=a(142),ze=a(143),Ye=a(132),Ze=a(139),Ke=a(18);function qe(e,t){return He.apply(this,arguments)}function He(){return(He=Object(ae.a)(te.a.mark((function e(t,a){var n,r=arguments;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>2&&void 0!==r[2]?r[2]:3,e.abrupt("return",new Promise((function(e,r){var c=function(t){e(t)},o=function(e){--n?setTimeout(i,100):r(e)},s=function(e){throw e};function i(){return fetch(t,a).then(c).catch(o).catch(s)}i();var u=new Error("request timeout");setTimeout(r,5e3,u)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Qe="".concat(window.location.protocol,"//").concat(window.location.host,"/dev/v2/project/%s/rtm").replace("%s","3a1a2513fbd24bd980a411d32f20307d"),$e=function(){function e(t,a){Object(C.a)(this,e),this.startTime=void 0,this.endTime=void 0,this.source=void 0,this.destination=void 0,this.customerId=void 0,this.appSecret=void 0,this.totalCount=void 0,this.offset=void 0,this.limit=void 0,this.startTime=0,this.endTime=0,this.source="",this.destination="",this.customerId=t,this.appSecret=a,this.totalCount=0,this.offset=0,this.limit=100}return Object(j.a)(e,[{key:"basicAuthorization",value:function(){var e="".concat(this.customerId,":").concat(this.appSecret);return"Basic ".concat(btoa(e))}},{key:"fetchChannelMessageCount",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a,n,r,c,o,s;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.rid,n=t.startTime,r=t.endTime,e.next=3,qe("".concat(Qe,"/message/history/count?destination=").concat(a,"&start_time=").concat(n,"&end_time=").concat(r),{method:"GET",headers:{"Content-Type":"application/json",Authorization:this.basicAuthorization()}});case 3:return c=e.sent,e.next=6,c.json();case 6:return o=e.sent,s=Object(S.get)(o,"count"),this.totalCount=s,this.offset=0,this.limit=100,e.abrupt("return",s);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchChannelMessages",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a,n,r,c,o,s,i,u,l;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.rid,n=t.startTime,r=t.endTime,e.next=3,qe("".concat(Qe,"/message/history/query"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.basicAuthorization()},body:JSON.stringify({filter:{source:"",destination:a,start_time:n,end_time:r},offset:this.offset,limit:this.limit,order:"asc"})});case 3:return c=e.sent,e.next=6,c.json();case 6:if(o=e.sent,s=Object(S.get)(o,"location"),!Object(S.isEmpty)(s)){e.next=10;break}throw"location from agora rtm endpoint must be present";case 10:return e.next=12,qe("".concat(Qe,"/message/history/query/").concat(s.replace("~/rtm/message/history/query/","")),{method:"GET",headers:{"Content-Type":"application/json",Authorization:this.basicAuthorization()}});case 12:return i=e.sent,e.next=15,i.json();case 15:return u=e.sent,l=Object(S.get)(u,"messages"),e.abrupt("return",l);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAllChannelMessages",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a,n,r,c;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchChannelMessageCount(t);case 2:if(0!==e.sent){e.next=5;break}return e.abrupt("return",void 0);case 5:a=this.totalCount,n=[];case 7:if(!(a>0)){e.next=15;break}return e.next=10,this.fetchChannelMessages(t);case 10:c=e.sent,n=(r=n).concat.apply(r,Object(Le.a)(c)),a>=c.length&&(a-=c.length,this.offset=n.length,this.limit=100),e.next=7;break;case 15:return e.abrupt("return",n);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();window.RTMRestful=new $e("customer_id","customer_certificate");var Xe="WHITEcGFydG5lcl9pZD0xTnd5aDBsMW9ZazhaRWNuZG1kaWgwcmJjVWVsQnE1UkpPMVMmc2lnPWI5ZGRmNTU1YTgwM2Q0NjFjMDY5YTQ3NDA2ZDMxN2Q5NTVmYTJjYjY6YWRtaW5JZD01MjEmcm9sZT1taW5pJmV4cGlyZV90aW1lPTE2MDM3OTIwOTMmYWs9MU53eWgwbDFvWWs4WkVjbmRtZGloMHJiY1VlbEJxNVJKTzFTJmNyZWF0ZV90aW1lPTE1NzIyMzUxNDEmbm9uY2U9MTU3MjIzNTE0MDY3MTAw",et=function(e){return Object(ae.a)(te.a.mark((function t(){var a,n,r,c,o;return te.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.rid,n=e.limit,r=e.mode,t.next=3,qe("".concat("https://cloudcapiv4.herewhite.com/room?token=").concat(Xe),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,limit:n,mode:r})});case 3:return c=t.sent,t.next=6,c.json();case 6:return o=t.sent,t.abrupt("return",{uuid:Object(S.get)(o,"msg.room.uuid"),roomToken:Object(S.get)(o,"msg.roomToken")});case 8:case"end":return t.stop()}}),t)})))()},tt=function(e,t){return Object(ae.a)(te.a.mark((function t(){var a,n;return te.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,qe("".concat("https://cloudcapiv4.herewhite.com/room/join?token=").concat(Xe,"&uuid=").concat(e),{method:"POST",headers:{"content-type":"application/json"}});case 2:return a=t.sent,t.next=5,a.json();case 5:return n=t.sent,t.abrupt("return",{uuid:e,roomToken:Object(S.get)(n,"msg.roomToken")});case 7:case"end":return t.stop()}}),t)})))()},at=function(e,t,a){return Object(ae.a)(te.a.mark((function n(){var r,c;return te.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.replayRoom({beginTimestamp:t.beginTimestamp,duration:t.duration,room:t.room,mediaURL:t.mediaURL,roomToken:t.roomToken},a);case 3:return c=n.sent,r=!1,n.abrupt("return",c);case 8:n.prev=8,n.t0=n.catch(0),r=!0;case 11:if(r){n.next=0;break}case 12:case"end":return n.stop()}}),n,null,[[0,8]])})))()},nt="https://apiagoraio.herewhite.com".replace("%s","3a1a2513fbd24bd980a411d32f20307d"),rt=function(){function e(t,a,n){Object(C.a)(this,e),this.agoraAppId=void 0,this.customerId=void 0,this.customerCertificate=void 0,this.channelName=void 0,this.mode=void 0,this.recordingConfig=void 0,this.storageConfig=void 0,this.recordId=void 0,this.resourceId=void 0,this.uid=void 0,this.token=void 0,this.agoraAppId=t.agoraAppId,this.customerId=t.customerId,this.customerCertificate=t.customerCertificate,this.channelName=t.channelName,this.recordingConfig=a,this.storageConfig=n,this.mode=t.mode,this.uid=t.uid,this.token=t.token}return Object(j.a)(e,[{key:"acquire",value:function(){var e=Object(ae.a)(te.a.mark((function e(){var t,a;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qe("".concat(nt,"/v1/apps/").concat(this.agoraAppId,"/cloud_recording/acquire"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.basicAuthorization(this.customerId,this.customerCertificate)},body:JSON.stringify({cname:this.channelName,uid:this.uid,clientRequest:{}})});case 2:return t=e.sent,e.next=5,t.json();case 5:if("string"!==typeof(a=e.sent).resourceId){e.next=10;break}this.resourceId=a.resourceId,e.next=11;break;case 10:throw{recordingErr:{message:"acquire recording failed"},reason:"resourceId is invalid"};case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"release",value:function(){var e=Object(ae.a)(te.a.mark((function e(){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.resourceId=void 0,this.recordId=void 0;case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=Object(ae.a)(te.a.mark((function e(){var t,a;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.resourceId){e.next=2;break}throw{recordingErr:{message:"start recording failed"},reason:"resourceId is undefined"};case 2:return e.next=4,qe("".concat(nt,"/v1/apps/").concat(this.agoraAppId,"/cloud_recording/resourceid/").concat(this.resourceId,"/mode/").concat(this.mode,"/start"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.basicAuthorization(this.customerId,this.customerCertificate)},body:JSON.stringify({cname:this.channelName,uid:this.uid,clientRequest:{token:this.token,recordingConfig:this.recordingConfig,storageConfig:this.storageConfig}})});case 4:return t=e.sent,e.next=7,t.json();case 7:if("string"!==typeof(a=e.sent).sid){e.next=12;break}this.recordId=a.sid,e.next=13;break;case 12:throw{recordingErr:{message:"start recording failed"},reason:"recordId is invalid"};case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){var e=Object(ae.a)(te.a.mark((function e(){var t,a;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.resourceId){e.next=2;break}throw{recordingErr:{message:"stop recording failed"},reason:"resourceId is undefined"};case 2:if(void 0!==this.recordId){e.next=4;break}throw{recordingErr:{message:"stop recording failed"},reason:"recordId is undefined"};case 4:return e.prev=4,e.next=7,qe("".concat(nt,"/v1/apps/").concat(this.agoraAppId,"/cloud_recording/resourceid/").concat(this.resourceId,"/sid/").concat(this.recordId,"/mode/").concat(this.mode,"/stop"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.basicAuthorization(this.customerId,this.customerCertificate)},body:JSON.stringify({cname:this.channelName,uid:this.uid,clientRequest:{}})});case 7:return t=e.sent,e.next=10,t.json();case 10:return a=e.sent,e.abrupt("return",a);case 14:e.prev=14,e.t0=e.catch(4),console.log("stop",e.t0);case 17:return e.prev=17,e.next=20,this.release();case 20:return e.finish(17);case 21:case"end":return e.stop()}}),e,this,[[4,14,17,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"query",value:function(){var e=Object(ae.a)(te.a.mark((function e(){var t,a;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.resourceId){e.next=2;break}throw{recordingErr:{message:"query recording failed"},reason:"resourceId is undefined"};case 2:if(void 0!==this.recordId){e.next=4;break}throw{recordingErr:{message:"query recording failed"},reason:"recordId is undefined"};case 4:return e.next=6,qe("".concat(nt,"/v1/apps/").concat(this.agoraAppId,"/cloud_recording/resourceid/").concat(this.resourceId,"/sid/").concat(this.recordId,"/mode/").concat(this.mode,"/query"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:this.basicAuthorization(this.customerId,this.customerCertificate)}});case 6:return t=e.sent,e.next=9,t.json();case 9:return a=e.sent,e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"basicAuthorization",value:function(e,t){var a="".concat(e,":").concat(t);return"Basic ".concat(btoa(a))}}]),e}(),ct=function(e){return/\/([^\/]*)\//g.exec(e),"aria"===RegExp.$1?"":RegExp.$1},ot=Object(Ke.createPlugins)({video:Ye.videoPlugin,audio:Ze.audioPlugin});ot.setPluginContext("video",{identity:"guest"}),ot.setPluginContext("audio",{identity:"guest"});var st=new(function(e){Object(ze.a)(a,e);var t=Object(Je.a)(a);function a(){var e;return Object(C.a)(this,a),(e=t.call(this)).state=void 0,e.subject=void 0,e.defaultState=Object(p.a)({joined:!1,scenes:Object(Ce.b)(),currentScenePath:"",currentHeight:0,currentWidth:0,dirs:[],activeDir:0,zoomRadio:0,scale:0,recording:!1,startTime:0,endTime:0,room:null,loading:!0},P.read("mediaDirs")),e.client=new Ke.WhiteWebSdk({deviceType:Ke.DeviceType.Surface,plugins:ot,loggerOptions:{disableReportLog:!1,reportLevelMask:"debug",printLevelMask:"debug"}}),e.operator=null,e.subject=null,e.state=e.defaultState,e}return Object(j.a)(a,[{key:"initialize",value:function(){this.subject=new x.a,this.state=Object(p.a)({},this.defaultState),this.subject.next(this.state)}},{key:"subscribe",value:function(e){this.initialize(),this.subject&&this.subject.subscribe(e)}},{key:"unsubscribe",value:function(){this.subject&&this.subject.unsubscribe(),this.subject=null}},{key:"commit",value:function(e){this.subject&&this.subject.next(e)}},{key:"updateState",value:function(e){this.state=Object(p.a)({},this.state,{},e),this.commit(this.state)}},{key:"updateRoomState",value:function(e){if(this.state.room){var t=this.state.room.state,a=t.sceneState.scenePath,n=t.sceneState.scenes[0].ppt,r=Object(S.isEmpty)(n)?"static":"dynamic",c=t.sceneState.index,o=t.sceneState.scenes.length;this.state="dynamic"!==r?Object(p.a)({},this.state,{currentHeight:0,currentWidth:0}):Object(p.a)({},this.state,{currentHeight:Object(S.get)(n,"height",0),currentWidth:Object(S.get)(n,"width",0)});var s=ct(a),i=""===s?"/init":"/".concat(s),u=this.state.scenes.update(i,(function(a){var n={name:"whiteboard",type:"whiteboard"};e&&"/init"!==i&&(n.name=e.name,n.type=e.type);var s=Object(p.a)({},a,{path:i,type:r||"static",currentPage:c,totalPage:o});return a&&!Object(S.isEmpty)(a.file)||(s.file=n),a&&!Object(S.isEmpty)(a.rootPath)||(s.rootPath=t.sceneState.scenePath),s})),l=[];u.forEach((function(e){l.push({path:e.path,rootPath:e.rootPath,file:e.file})}));var m=l.findIndex((function(e){return e.path===i}));this.state=Object(p.a)({},this.state,{scenes:u,currentScenePath:i,dirs:l,activeDir:-1!==m?m:0}),this.commit(this.state)}}},{key:"setCurrentScene",value:function(e){var t=this.state.dirs.findIndex((function(t){return t.path===e}));this.state=Object(p.a)({},this.state,{currentScenePath:e,activeDir:-1!==t?t:0}),this.commit(this.state)}},{key:"updateSceneState",value:function(e){var t=e.scenePath,a=e.index,n=e.scenes.length,r=ct(t),c=""===r?"/init":"/".concat(r),o=this.state.scenes.update(c,(function(e){return Object(p.a)({},e,{currentPage:a,totalPage:n})}));this.state=Object(p.a)({},this.state,{scenes:o}),this.commit(this.state)}},{key:"updateScale",value:function(e){this.state=Object(p.a)({},this.state,{scale:e}),this.commit(this.state)}},{key:"connect",value:function(){var e=Object(ae.a)(te.a.mark((function e(t,a){var n,r,c,o;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=0;case 1:if(e.prev=1,o=void 0,!a){e.next=9;break}return e.next=6,tt(a);case 6:o=e.sent,e.next=12;break;case 9:return e.next=11,et({rid:t,limit:100,mode:"historied"});case 11:o=e.sent;case 12:return n=!1,e.abrupt("return",o);case 16:e.prev=16,e.t0=e.catch(1),n=!0,r++,c=e.t0;case 21:if(n&&r<3){e.next=1;break}case 22:throw c;case 23:case"end":return e.stop()}}),e,null,[[1,16]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"updateLoading",value:function(e){this.state=Object(p.a)({},this.state,{loading:e}),this.commit(this.state)}},{key:"join",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){var a,n,r,c,o,s,i,u,l,m,d,h=this;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.rid,n=t.uid,r=t.location,c=t.userPayload,e.next=3,this.leave();case 3:return e.next=5,this.connect(a,n);case 5:return o=e.sent,s=o.uuid,i=o.roomToken,u="host"===c.identity?"host":"guest",ot.setPluginContext("video",{identity:u}),ot.setPluginContext("audio",{identity:u}),l=!(!r.match(/big-class/)||"host"===u),m=!(!r.match(/big-class/)||"host"===u),console.log("[White] disableDeviceInputs, ".concat(l,", disableOperations, ").concat(m,", location: ").concat(r)),e.next=16,this.client.joinRoom({uuid:s,roomToken:i,disableBezier:!0,disableDeviceInputs:l,disableOperations:m},{onPhaseChanged:function(e){e===Ke.RoomPhase.Connected?h.updateLoading(!1):h.updateLoading(!0),console.log("[White] onPhaseChanged phase : ",e)},onRoomStateChanged:function(e){e.zoomScale&&st.updateScale(e.zoomScale),e.sceneState&&st.updateRoomState()},onDisconnectWithError:function(e){},onKickedWithReason:function(e){},onKeyDown:function(e){},onKeyUp:function(e){},onHandToolActive:function(e){},onPPTLoadProgress:function(e,t){}});case 16:return d=e.sent,e.next=19,xe.updateWhiteboardUid(d.uuid);case 19:this.state=Object(p.a)({},this.state,{room:d}),this.commit(this.state);case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"cleanRoom",value:function(){this.state=Object(p.a)({},this.state,{room:null}),this.commit(this.state)}},{key:"leave",value:function(){var e=Object(ae.a)(te.a.mark((function e(){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.room){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.state.room.disconnect();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.warn("disconnect whiteboard failed",e.t0);case 10:return e.prev=10,this.cleanRoom(),console.log("cleanRoom"),e.finish(10);case 14:this.updateLoading(!0);case 15:case"end":return e.stop()}}),e,this,[[2,7,10,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=Object(ae.a)(te.a.mark((function e(){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.leave();case 2:this.state=Object(p.a)({},this.defaultState),this.commit(this.state),this.removeAllListeners();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startRecording",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state){e.next=2;break}return e.abrupt("return");case 2:return this.operator=new rt({agoraAppId:"3a1a2513fbd24bd980a411d32f20307d",customerId:"customer_id",customerCertificate:"customer_certificate",channelName:xe.state.course.rid,mode:"mix",token:t,uid:"".concat(1)},{audioProfile:1,transcodingConfig:{width:240,height:180,bitrate:120,fps:15}},{vendor:2,region:ge("your_bucket_region"),bucket:"your_oss_bucket_name",accessKey:"your_bucket_ak",secretKey:"your_bucket_sk"}),e.next=5,this.operator.acquire();case 5:return e.next=7,this.operator.start();case 7:this.state=Object(p.a)({},this.state,{recording:!0,startTime:+Date.now()}),this.commit(this.state);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopRecording",value:function(){var e=Object(ae.a)(te.a.mark((function e(){var t,a;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.operator.query();case 4:return e.next=6,this.operator.stop();case 6:return t=e.sent,a=Object(S.get)(t,"serverResponse.fileList"),this.state=Object(p.a)({},this.state,{recording:!1,endTime:+Date.now()}),this.commit(this.state),e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"clearRecording",value:function(){if(!this.state.room)throw console.warn("whiteboard is released",this.state.room),"whiteboard is released";var e=this.state.endTime,t=this.state.startTime,a=this.state.room.uuid;return this.state=Object(p.a)({},this.state,{endTime:0,startTime:0,recording:!1}),this.commit(this.state),{endTime:e,startTime:t,roomUUID:a}}},{key:"lock",value:function(){var e=Object(ae.a)(te.a.mark((function e(){var t,a;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Boolean(xe.state.me.lockBoard),(a=t?0:1)?I.showToast({type:"notice-board",message:U("toast.whiteboard_lock")}):I.showToast({type:"notice-board",message:U("toast.whiteboard_unlock")}),e.next=5,xe.updateMe({lockBoard:a});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),a}(ne.EventEmitter));function it(e){var t=r.a.useState(e.defaultState),a=Object(v.a)(t,2),n=a[0],c=a[1];return r.a.useEffect((function(){return e.subscribe((function(e){c(e)})),function(){e.unsubscribe()}}),[]),n}window.netlessStore=st;var ut=r.a.createContext({}),lt=function(){var e=r.a.useContext(ut);if(void 0===e)throw new Error("useStore must be used within a RootProvider");return e},mt=function(){return lt().globalState},dt=function(){return lt().roomState},ht=function(e){var t=e.children,a=it(I),c=it(xe),o=it(st),i=it(Fe),u=Object(s.f)(),l=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){l.current=!0}}),[]);var m={globalState:a,roomState:c,whiteboardState:o,errorState:i};Object(n.useEffect)((function(){if(xe.state.rtm.joined){var e=xe.rtmClient;return e.on("ConnectionStateChanged",(function(e){var t=e.newState,a=e.reason;return console.log("newState: ".concat(t," reason: ").concat(a)),"LOGIN_FAILURE"===a?(I.showToast({type:"rtmClient",message:U("toast.login_failure")}),void u.push("/")):"REMOTE_LOGIN"===a||"ABORTED"===t?(I.showToast({type:"rtmClient",message:U("toast.kick")}),void u.push("/")):void 0})),e.on("MessageFromPeer",(function(e){var t=e.message.text,a=e.peerId,n=(e.props,function(e){return Ee(e)}(t));_e(a,n),xe.handlePeerMessage(n.cmd,a).then((function(){})).catch(console.warn)})),e.on("AttributesUpdated",(function(e){console.log("[rtm-client] updated origin attributes",e),xe.updateRoomAttrs(e)})),e.on("MemberJoined",(function(e){})),e.on("MemberLeft",(function(e){xe.state.applyUid===+e&&xe.updateCourseLinkUid(0).then((function(){I.removeNotice()})).catch(console.warn)})),e.on("MemberCountUpdated",(function(e){!l.current&&xe.updateMemberCount(e)})),e.on("ChannelMessage",(function(e){var t=e.memberId,a=Ee(e.message.text),n={account:a.account,text:a.content,link:a.link,ts:+Date.now(),id:t};console.log("[rtmClient] ChannelMessage",a),"chatroom"===I.state.active?I.setMessageCount(0):I.setMessageCount(I.state.newMessageCount+1),xe.updateChannelMessage(n)})),function(){e.removeAllListeners()}}}),[xe.state.rtm.joined]);var d=Object(s.g)();return Object(n.useEffect)((function(){if("/"!==d.pathname){var e=m.roomState;P.save("agora_room",{me:e.me,course:e.course,mediaDevice:e.mediaDevice}),P.save("language",m.globalState.language),window.errorState=i,window.room=c,window.globalState=a,window.whiteboard=o}}),[m,d]),r.a.createElement(ut.Provider,{value:m},t)},ft=r.a.memo((function(e){var t=e.preview,a=e.role,c=e.account,o=e.stream,s=e.className,i=e.domId,u=e.streamID,l=e.audio,m=e.id,d=e.video,h=e.handleClick,f=e.local,p=e.handleClose,b=e.close,g=Object(n.useRef)(!1),_=Object(n.useRef)(!1),E=Object(n.useRef)(!1),y=Object(n.useState)(!1),k=Object(v.a)(y,2),O=k[0],w=k[1];Object(n.useEffect)((function(){if(i&&o&&Oe);}),[i,o,Oe]),Object(n.useEffect)((function(){if(o&&i&&(!E.current||!o.isPlaying()))return E.current=!0,o.play("".concat(i),{fit:"cover"},(function(e){E.current=!1,console.warn("[video-player] ",JSON.stringify(e),m,o.isPaused(),o.isPlaying()," isLocal: ",f),e&&"aborted"!==e.status&&!f&&(o.isPaused()&&w(!0),console.warn("[video-player] play failed ",JSON.stringify(e),m,o.isPaused(),o.isPlaying()))})),function(){o.isPlaying()&&o.stop()}}),[i,o]),Object(n.useEffect)((function(){if(o){if(!_.current)return l||(o.muteAudio(),console.log("strea mute audio")),void(_.current=!0);l?(console.log("stream unmute audio"),o.unmuteAudio()):(console.log("stream mute audio"),o.muteAudio())}}),[o,l,Oe]),Object(n.useEffect)((function(){if(o){if(!g.current)return d||(console.log("stream mute video"),o.muteVideo()),void(g.current=!0);d?(console.log("stream unmute video"),o.unmuteVideo()):(console.log("stream mute video"),o.muteVideo())}}),[o,d,Oe]);var C=dt().me;return r.a.createElement("div",{className:"".concat(s||(t?"preview-video rotateY180deg":"agora-video-view ".concat(!1===Boolean(d)&&o?"show-placeholder":"")))},b?r.a.createElement("div",{className:"icon-close",onClick:function(e){p&&m&&p("close",u)}}):null,"screen-sharing"!==s?r.a.createElement("div",{className:"teacher"===a?"teacher-placeholder":"student-placeholder"}):null,t?null:c?r.a.createElement("div",{className:"video-profile"},r.a.createElement("span",{className:"account"},c),C.uid===m||"teacher"===C.role?r.a.createElement("span",{className:"media-btn"},r.a.createElement(V,{onClick:function(e){h&&m&&h("audio",u,m)},className:l?"icon-speaker-on":"icon-speaker-off",data:"audio"}),r.a.createElement(V,{onClick:function(e){h&&m&&h("video",u,m)},className:d?"icons-camera-unmute-s":"icons-camera-mute-s",data:"video"})):null):null,r.a.createElement("div",{id:"".concat(i),className:"agora-rtc-video ".concat(f?"rotateY180deg":"")}),O?r.a.createElement("div",{className:"clickable",onClick:function(){o.resume().then((function(){w(!1),console.log("clickable")})).catch(console.warn)}}):null)}));var pt=Object(g.a)({formControl:{minWidth:"240px",maxWidth:"240px"}}),vt=function(e){var t=pt(),a=Q().SettingBtn,c=function(){var e=Object(n.useState)([]),t=Object(v.a)(e,2),a=t[0],c=t[1],o=Q().platform,s=Object(n.useMemo)((function(){return a.filter((function(e){return"videoinput"===e.kind}))}),[a]),i=Object(n.useMemo)((function(){return a.filter((function(e){return"audioinput"===e.kind}))}),[a]),u=Object(n.useMemo)((function(){return a.filter((function(e){return"audiooutput"===e.kind}))}),[a]),l=dt(),m=Object(n.useMemo)((function(){return l.mediaDevice}),[l.mediaDevice]),d=Object(n.useState)(m.camera),h=Object(v.a)(d,2),f=h[0],p=h[1],b=Object(n.useState)(m.microphone),g=Object(v.a)(b,2),_=g[0],E=g[1],y=Object(n.useState)(m.speaker),k=Object(v.a)(y,2),O=k[0],w=k[1],C=Object(n.useState)(m.speakerVolume),j=Object(v.a)(C,2),x=j[0],S=j[1],T=Object(n.useState)(0),N=Object(v.a)(T,2),P=N[0],A=N[1],I=!1;Object(n.useEffect)((function(){var e=xe.rtcClient;if(o&&e){if("web"===o&&!I){window.onload=function(){try{navigator.mediaDevices.getUserMedia({video:!0})}catch(e){alert(e)}};var t=e,a=function(){var e=Object(ae.a)(te.a.mark((function e(){var a;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getDevices();case 2:a=e.sent,alert(a),c(a.map((function(e){return{value:e.deviceId,text:e.label,kind:e.kind}})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return window.addEventListener("devicechange",a),a().then((function(){})).catch(console.warn),I=!0,function(){window.removeEventListener("devicechange",a)}}if("electron"===o&&!I){var n=e,r=function(){var e=Object(ae.a)(te.a.mark((function e(){var t,a,r,o,s,i;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.rtcEngine.getAudioRecordingDevices();case 2:return t=e.sent,e.next=5,n.rtcEngine.getAudioPlaybackDevices();case 5:return a=e.sent,e.next=8,n.rtcEngine.getVideoDevices();case 8:r=e.sent,o=t.map((function(e){return{kind:"audioinput",text:e.devicename,value:e.deviceid}})),s=a.map((function(e){return{kind:"audiooutput",text:e.devicename,value:e.deviceid}})),i=r.map((function(e){return{kind:"videoinput",text:e.devicename,value:e.deviceid}})),c([].concat(o).concat(s).concat(i));case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r().then((function(){return console.log("electron devices changed")})).catch(console.warn),n.on("videodevicestatechanged",r),n.on("audiodevicestatechanged",r),I=!0,function(){n.off("videodevicestatechanged",r),n.off("audiodevicestatechanged",r)}}}}),[o]);var R=Object(n.useMemo)((function(){return s[f]?s[f].value:""}),[s,f]),M=Object(n.useMemo)((function(){return i[_]?i[_].value:""}),[i,_]),D=Object(n.useMemo)((function(){return u[O]?u[O].value:""}),[u,O]),L=Object(n.useState)(null),U=Object(v.a)(L,2),W=U[0],B=U[1],V=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){V.current=!0}}),[]);var G=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){G.current=!0}}),[]),Object(n.useEffect)((function(){if(!G.current&&D&&R&&M){var e=xe.rtcClient;if(G.current=!0,"web"===o){var t=e;!V.current&&t.createPreviewStream({cameraId:R,microphoneId:M,speakerId:D}).then((function(e){!V.current&&B(e)})).finally((function(){G.current=!1}))}if("electron"===o){var a=e.createStream({streamID:0,cameraId:R,microphoneId:M,speakerId:D});B(a),G.current=!1}}}),[o,D,R,M]);var F=Object(n.useRef)(null);Object(n.useEffect)((function(){if(W&&W.getAudioLevel)return F.current=setInterval((function(){!V.current&&A(W.getAudioLevel())}),300),function(){F.current&&clearInterval(F.current),F.current=null}}),[W]),Object(n.useEffect)((function(){if(W&&"electron"===o){console.log("[electron-client] add volume event listener");var e=function(e,t,a,n){A(Number((n/255).toFixed(3)))},t=xe.rtcClient;return t.rtcEngine.setClientRole(1),t.rtcEngine.enableAudioVolumeIndication(1e3,3,!1),t.rtcEngine.on("audiovolumeindication",e),console.log("startplayback on result",t.rtcEngine.startAudioRecordingDeviceTest(300)),function(){t.rtcEngine.off("audiovolumeindication",e),console.log("startplayback off result",t.rtcEngine.stopAudioPlaybackDeviceTest())}}}),[W]);var J=Object(n.useCallback)((function(){return W?r.a.createElement(ft,{domId:"local",preview:!0,stream:W,streamID:0,video:!0,audio:!0,local:!0}):null}),[W]),z=Object(n.useCallback)((function(){return r.a.createElement(Ve,{volume:P})}),[P]);return{volume:P,cameraList:s,microphoneList:i,speakerList:u,camera:f,microphone:_,speaker:O,setCamera:p,setMicrophone:E,setSpeaker:w,speakerVolume:x,setSpeakerVolume:S,PreviewPlayer:J,MicrophoneVolume:z,save:function(e){var t=e.camera,a=e.microphone,n=e.speaker,r=e.speakerVolume,c={cameraId:s[t]?s[t].value:"",microphoneId:i[a]?i[a].value:"",speakerId:u[n]?u[n].value:"",camera:t,microphone:a,speaker:n,speakerVolume:r};V.current=!0,xe.updateDevice(c),W&&W.close&&W.close()}}}(),o=c.cameraList,s=c.microphoneList,i=c.speakerList,u=c.camera,l=c.microphone,m=c.speaker,d=c.setCamera,h=c.setMicrophone,f=c.setSpeaker,p=(c.volume,c.speakerVolume),g=c.setSpeakerVolume,_=c.save,y=(c.PreviewPlayer,c.MicrophoneVolume);return r.a.createElement("div",{className:e.className?e.className:"flex-container"},r.a.createElement("div",{className:"custom-card"},r.a.createElement("div",{className:"flex-item card"},r.a.createElement("div",{className:"position-top card-menu"},r.a.createElement("div",null),r.a.createElement("div",{className:"icon-container"},r.a.createElement(a,null))),r.a.createElement("div",{className:"position-content flex-direction-column"},r.a.createElement(b.a,{className:t.formControl},r.a.createElement(Ie,{Label:U("device.camera"),value:u,onChange:function(e){console.log("changeCamera ",e.target.value),d(e.target.value)},items:o})),r.a.createElement(b.a,{className:t.formControl},r.a.createElement(Ie,{Label:U("device.microphone"),value:l,onChange:function(e){console.log("changeMicrophone ",e.target.value),h(e.target.value)},items:s}),r.a.createElement(y,null)),r.a.createElement(b.a,{className:t.formControl},r.a.createElement(Ie,{Label:U("device.speaker"),value:m,onChange:function(e){console.log("changeSpeaker ",e.target.value),f(e.target.value)},items:i}),r.a.createElement(De,{volume:p,onChange:function(e){console.log("changeSpeaker ",e),g(e)}})),r.a.createElement(E,{name:U("device.finish"),onClick:function(t){_({speakerVolume:p,camera:u,microphone:l,speaker:m}),e.handleFinish(t)}})))))};var bt,gt=r.a.memo((function(){var e=Object(s.f)();return Object(n.useEffect)((function(){var e=xe.rtcClient;return function(){e.tmpStream&&(e.tmpStream.isPlaying()&&e.tmpStream.stop(),e.tmpStream.close())}}),[]),r.a.createElement("div",{className:"flex-container ".concat("home-cover-web")},r.a.createElement(vt,{handleFinish:function(t){e.goBack()}}))})),_t=(a(217),a(59)),Et=a.n(_t);!function(e){e[e.CLOSED=0]="CLOSED",e[e.STARTED=1]="STARTED"}(bt||(bt={}));var yt=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n;Object(C.a)(this,e),this.stream=t,this.streamID=a,this.local=n},kt={excellent:"network-good",good:"network-good",poor:"network-normal",bad:"network-normal","very bad":"network-bad",down:"network-bad",unknown:"network-bad"};function Ot(e){var t=e.delay,a=e.network,n=(e.cpu,e.role),c=e.roomName,o=e.time,s=e.handleClick,i=e.showSetting,u=e.classState,l=e.onCardConfirm,m=Q().NavBtn;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"nav-container ".concat("")},r.a.createElement("div",{className:"class-title"},r.a.createElement("span",{className:"room-name"},c),"teacher"===n?r.a.createElement(E,{className:"nav-button ".concat(u?"stop":"start"),name:U(u?"nav.class_end":"nav.class_start"),onClick:function(e){s("classState")}}):null),r.a.createElement("div",{className:"network-state"},r.a.createElement("span",{className:"net-field"},U("nav.delay"),r.a.createElement("span",{className:"net-field-value"},t)),r.a.createElement("span",{className:"net-field net-field-container"},U("nav.network"),r.a.createElement("span",{className:"net-field-value ".concat(kt[a]),style:{marginLeft:".2rem"}})),null),r.a.createElement("div",{className:"menu"},r.a.createElement("div",{className:"timer"},r.a.createElement(V,{className:"icon-time",disable:!0}),r.a.createElement("span",{className:"time"},_t.utc(o).format("HH:mm:ss"))),r.a.createElement("span",{className:"menu-split"}),r.a.createElement("div",{className:"btn-group"},r.a.createElement(r.a.Fragment,null,r.a.createElement(V,{className:"icon-setting",onClick:function(e){s("setting")}}),r.a.createElement(V,{className:"i18n-lang",onClick:function(e){s("i18n")}})),r.a.createElement(V,{className:"icon-exit",onClick:function(e){s("exit")}})),r.a.createElement(m,null))),i?r.a.createElement(vt,{className:"internal-card",handleFinish:function(e){l("setting")}}):null)}function wt(){var e=Q().platform,t=Object(n.useRef)(!1),a=Object(n.useState)(0),c=Object(v.a)(a,2),o=c[0],s=c[1],i=Object(n.useState)(null),u=Object(v.a)(i,2),l=u[0],m=u[1],d=Object(n.useState)(!1),h=Object(v.a)(d,2),f=h[0],p=h[1],b=Object(n.useState)(0),g=Object(v.a)(b,2),_=g[0],E=g[1],y=Object(n.useState)("unknown"),k=Object(v.a)(y,2),O=k[0],w=k[1],C=Object(n.useState)(0),j=Object(v.a)(C,2),x=j[0],S=j[1];Object(n.useEffect)((function(){return function(){t.current=!0,l&&(clearInterval(l),m(null))}}),[]);var T=dt(),N=T.me;Object(n.useEffect)((function(){var a=xe.rtcClient;if("web"===e){var n=a;return n.rtc.on("watch-rtt",(function(e){!t.current&&E(e)})),n.rtc.on("network-quality",(function(e){var a=ke(e);!t.current&&w(a)})),function(){n.rtc.off("watch-rtt",(function(){})),n.rtc.off("network-quality",(function(){}))}}if("electron"===e){var r=a;return r.on("rtcStats",(function(e){var a=e.cpuTotalUsage;!t.current&&S(a)})),r.on("networkquality",(function(e,a,n){if(0===e){var r=ke({downlinkNetworkQuality:n,uplinkNetworkQuality:a});!t.current&&w(r)}})),function(){r.off("rtcStats",(function(){})),r.off("networkquality",(function(){})),r.off("audioquality",(function(){}))}}}),[]);var P=T.course.courseState,A=T.course;Object(n.useEffect)((function(){if(P===bt.STARTED&&null===l){var e=+Date.now();m(function(e){return setInterval((function(){!t.current&&s(+Date.now()-e)}),150,e)}(e))}l&&P===bt.CLOSED&&(clearInterval(l),m(null))}),[P]);var R=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){R.current=!0}}),[]);return r.a.createElement(Ot,{role:N.role,roomName:A.roomName,classState:Boolean(A.courseState),delay:"".concat(_,"ms"),time:o,network:"".concat(O),cpu:"".concat(x,"%"),showSetting:f,onCardConfirm:function(e){switch(e){case"setting":return void p(!1);case"exitRoom":return void I.removeDialog()}},handleClick:function(e){"setting"===e?p(!0):"exit"===e?I.showDialog({type:"exitRoom",message:U("toast.quit_room")}):"classState"===e&&(R.current||(R.current=!0,xe.updateMe({courseState:+!Boolean(xe.state.course.courseState)}).then((function(){console.log("update success")})).catch(console.warn).finally((function(){R.current=!1}))))}})}var Ct=a(287),jt=a(281),xt=a(282);a(218);function St(e){var t=e.onConfirm,a=e.onClose,n=e.desc,c=e.type,o=function(){a(c)};return r.a.createElement("div",null,r.a.createElement(Ct.a,{disableBackdropClick:!0,open:!0,onClose:o,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(jt.a,{className:"modal-container"},r.a.createElement(xt.a,{className:"dialog-title"},n),r.a.createElement("div",{className:"button-group"},r.a.createElement(E,{name:U("toast.confirm"),className:"confirm",onClick:function(){t(c)},color:"primary"}),r.a.createElement(E,{name:U("toast.cancel"),className:"cancel",onClick:o,color:"primary"})))))}var Tt=r.a.memo((function(){var e=Object(s.f)(),t=mt().dialog;return Object(n.useMemo)((function(){return!!t.type}),[t])?r.a.createElement(St,{type:t.type,desc:t.message,onClose:function(e){"exitRoom"===e?I.removeDialog():"apply"===e&&xe.rtmClient.sendPeerMessage("".concat(xe.applyUid),{cmd:se.rejectCoVideo}).then((function(){I.removeDialog()})).catch(console.warn)},onConfirm:function(t){"exitRoom"===t?(I.removeDialog(),e.push("/")):"apply"===t&&Promise.all([xe.rtmClient.sendPeerMessage("".concat(xe.applyUid),{cmd:se.acceptCoVideo}),xe.updateCourseLinkUid(xe.applyUid)]).then((function(){console.log("applyUid"),I.removeNotice(),I.removeDialog()})).catch(console.warn)}}):null})),Nt=(a(219),a(220),function(e){e.ownerName;var t=e.name,a=e.className,n=(e.windowId,e.image);return r.a.createElement("div",{className:a||""},r.a.createElement("div",{className:"screen-image"},r.a.createElement("div",{className:"content",style:{backgroundImage:"url(data:image/png;base64,".concat(n,")")}})),r.a.createElement("div",{className:"screen-meta"},t))}),Pt=function(e){var t=e.title,a=e.items,n=e.windowId,c=e.selectWindow,o=e.confirm,s=e.cancel;return r.a.createElement("div",{className:"window-picker-mask"},r.a.createElement("div",{className:"window-picker"},r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"title"},t),r.a.createElement("div",{className:"cancelBtn",onClick:s})),r.a.createElement("div",{className:"screen-container"},a.map((function(e,t){return r.a.createElement("div",{className:"screen-item",key:t,onClick:function(){c(e.windowId)},onDoubleClick:o},r.a.createElement(Nt,{ownerName:e.ownerName,name:e.name,className:"window-item ".concat(e.windowId===n?"active":""),windowId:e.windowId,image:e.image}))}))),r.a.createElement("div",{className:"footer"},r.a.createElement(E,{className:"share-confirm-btn",name:"start",onClick:o}))))};function At(){var e=Q().platform,t=mt().nativeWindowInfo,a=r.a.useState(""),n=Object(v.a)(a,2),c=n[0],o=n[1];return t.visible?r.a.createElement(Pt,{windowId:c,title:"Please select and click window for share",items:t.items,cancel:function(){I.setNativeWindowInfo({visible:!1,items:[]})},selectWindow:function(e){o(e)},confirm:function(){var t=Object(ae.a)(te.a.mark((function t(a){var n,r,o;return te.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c){t.next=3;break}return console.warn("windowId is empty"),t.abrupt("return");case 3:if(t.prev=3,"electron"!==e){t.next=12;break}return n=xe.rtcClient,r=n,"",t.next=10,r.startScreenShare(c,"");case 10:o=t.sent,xe.addLocalSharedStream(new yt(o,o.uid,!0));case 12:t.next=17;break;case 14:throw t.prev=14,t.t0=t.catch(3),t.t0;case 17:return t.prev=17,I.setNativeWindowInfo({visible:!1,items:[]}),t.finish(17);case 20:case"end":return t.stop()}}),t,null,[[3,14,17,20]])})));return function(e){return t.apply(this,arguments)}}()}):null}var It=[{value:0,text:"One-on-One",path:"one-to-one"},{value:1,text:"Small Class",path:"small-class"},{value:2,text:"Large Class",path:"big-class"}];function Rt(e){var t=e.children,a=Object(s.f)(),c=Object(n.useRef)(!1);Object(n.useEffect)((function(){var e=xe.state.me,t=xe.state.course,n=t.rid,r=t.roomType,o=t.roomName,s=t.lockBoard,i=t.linkId,u=xe.state,l=u.rtmToken,m=u.rtcToken;n&&e.uid||a.push("/");var d={rid:n,roomName:o,roomType:r,lockBoard:s,rtmToken:l,rtcToken:m,linkId:i,uid:e.uid,role:e.role,video:e.video,audio:e.audio,chat:e.chat,account:e.account,boardId:e.boardId,sharedId:e.sharedId,grantBoard:e.grantBoard};c.current=!0,xe.state.rtm.joined||(I.showLoading(),xe.loginAndJoin(d,!0).then((function(){console.log("[biz-login]  loginAndJoin, success: ",JSON.stringify(d))})).catch((function(e){I.showToast({type:"rtmClient",message:U("toast.login_failure")}),a.push("/"),console.warn(e)})).finally((function(){I.stopLoading(),c.current=!1})))}),[]);var o=It[xe.state.course.roomType],i=Object(s.g)(),u=dt(),l=xe.state.me,m=xe.state.course,d=Boolean(i.pathname.match(/classroom/)),h=Boolean(i.pathname.match(/big-class/)),f=Boolean(i.pathname.match(/small-class/));Object(n.useEffect)((function(){return function(){I.removeUploadNotice(),xe.exitAll().then((function(){})).catch(console.warn).finally((function(){}))}}),[i]);var p=Object(n.useRef)(!1),v=Object(n.useMemo)((function(){return!h||h&&("teacher"===l.role||+l.uid===+m.linkId)}),[l.uid,m.linkId,l.role,h]);Object(n.useEffect)((function(){return function(){p.current=!0}}),[]);var b=Object(n.useRef)(!1),g=Object(n.useMemo)((function(){return{rtcJoined:u.rtc.joined,uid:u.me.uid,role:u.me.role,mediaDevice:u.mediaDevice}}),[u]),_=g.rtcJoined,E=g.uid,y=g.role,k=g.mediaDevice;return Object(n.useEffect)((function(){if(i.pathname.match(/big-class/)&&"teacher"!==l.role&&!m.linkId){var e=xe.rtcClient,t=e;if(t.published)t.unpublishLocalStream().then((function(){console.log("[agora-web] unpublish local stream")})).catch(console.warn)}}),[l.role,i.pathname,m.linkId]),Object(n.useEffect)((function(){if(_&&!p.current){var e=xe.rtcClient,t={streamID:+xe.state.me.uid,video:!0,audio:!0,mirror:!1,screen:!1,microphoneId:k.microphoneId,cameraId:k.cameraId,audioOutput:{volume:k.speakerVolume,deviceId:k.speakerId}};console.log("canPb>>> ",v,xe.state.course.linkId,xe.state.me.uid),v&&!b.current&&(b.current=!0,e.publishLocalStream(t).then((function(){console.log("[agora-web] publish local stream")})).catch(console.warn).finally((function(){b.current=!1})))}}),[_,E,y,k,v]),Object(n.useEffect)((function(){if(u.me.uid&&u.course.rid&&d){var e=xe.rtcClient;if(e.joined||p.current)return;return console.log("[agora-rtc] add event listener"),e.rtc.on("onTokenPrivilegeWillExpire",(function(t){e.rtc.renewToken(""),console.log("[agora-web] onTokenPrivilegeWillExpire",t)})),e.rtc.on("onTokenPrivilegeDidExpire",(function(t){e.rtc.renewToken(""),console.log("[agora-web] onTokenPrivilegeDidExpire",t)})),e.rtc.on("error",(function(e){console.log("[agora-web] error evt",e)})),e.rtc.on("stream-published",(function(e){var t=e.stream,a=new yt(t,t.getId(),!0);xe.addLocalStream(a)})),e.rtc.on("stream-subscribed",(function(t){var a=t.stream,n=a.getId();i.pathname.match(/small-class/)&&7!==n&&(xe.state.course.teacherId&&xe.state.course.teacherId==="".concat(n)?(e.setRemoteVideoStreamType(a,0),console.log("[agora-web] dual stream set high for teacher")):(e.setRemoteVideoStreamType(a,1),console.log("[agora-web] dual stream set low for student")));var r=new yt(a,a.getId(),!1);console.log("[agora-web] subscribe remote stream, id: ",a.getId()),xe.addRemoteStream(r)})),e.rtc.on("stream-added",(function(t){var a=t.stream;console.log("[agora-web] added remote stream, id: ",a.getId()),e.subscribe(a)})),e.rtc.on("stream-removed",(function(e){var t=e.stream;console.log("[agora-web] removed remote stream, id: ",t.getId(),xe.applyUid),t.getId()===xe.applyUid&&(I.removeNotice(),"teacher"===l.role&&xe.updateCourseLinkUid(0).then((function(){console.log("update teacher link_uid to 0")})).catch(console.warn)),xe.removeRemoteStream(t.getId())})),e.rtc.on("peer-online",(function(e){var t=e.uid;console.log("[agora-web] peer-online, id: ",t),xe.addPeerUser(t)})),e.rtc.on("peer-leave",(function(e){var t=e.uid;console.log("[agora-web] peer-leave, id: ",t,xe.applyUid),t===xe.applyUid&&(I.removeNotice(),"teacher"===l.role&&xe.updateCourseLinkUid(0).then((function(){console.log("update teacher link_uid to 0")})).catch(console.warn)),xe.removePeerUser(t),xe.removeRemoteStream(t)})),e.rtc.on("stream-fallback",(function(e){var t=e.uid,a=0===e.attr?"resume to a&v mode":"fallback to audio mode";console.info("[agora-web] stream: ".concat(t," fallback: ").concat(a))})),p.current=!0,e.joinChannel({uid:+u.me.uid,channel:u.course.rid,token:"",dual:f}).then((function(){})).catch(console.warn).finally((function(){p.current=!1})),function(){for(var t=0,a=["onTokenPrivilegeWillExpire","onTokenPrivilegeDidExpire","error","stream-published","stream-subscribed","stream-added","stream-removed","peer-online","peer-leave","stream-fallback"];t<a.length;t++){var n=a[t];e.rtc.off(n,(function(){}))}console.log("[agora-web] remove event listener"),!p.current&&e.exit().then((function(){console.log("[agora-web] do remove event listener")})).catch(console.warn).finally((function(){p.current=!0,xe.removeLocalStream()}))}}}),[JSON.stringify([u.me.uid,u.course.rid])]),r.a.createElement("div",{className:"classroom ".concat(o.path)},r.a.createElement(At,null),r.a.createElement(wt,null),t,r.a.createElement(Tt,null))}var Mt=a(283),Dt=Object(g.a)((function(e){return{progress:{margin:e.spacing(2),color:"#44A2FC"},container:{position:"absolute",top:"0px",left:"0px",height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",background:"#ffffff",opacity:.8,zIndex:10}}})),Lt=function(){var e=Dt();return r.a.createElement("div",{className:e.container},r.a.createElement(Mt.a,{className:e.progress}))};function Ut(){return mt().loading?r.a.createElement(Lt,null):null}a(221);function Wt(e){var t=e.duration,a=void 0===t?1500:t,c=mt(),o=r.a.useRef([]),s=Object(n.useState)([]),i=Object(v.a)(s,2),u=i[0],l=i[1],m=Object(n.useRef)(null);return Object(n.useEffect)((function(){u.length>0&&null===m.current&&(m.current=setTimeout((function(){o.current.shift(),l(Object(Le.a)(o.current)),m.current=null}),a))}),[u]),Object(n.useEffect)((function(){o.current&&c.toast.message&&(o.current.push({message:c.toast.message,key:+Date.now()}),l(Object(Le.a)(o.current)))}),[c.toast]),r.a.createElement("div",{className:"notice-message-container"},u.map((function(e,t){return r.a.createElement("div",{key:"".concat(t).concat(e.key),className:"custom-toast"},r.a.createElement("div",{className:"toast-container"},r.a.createElement("span",{className:"text"},e.message)))})))}a(222),a(223),a(224);var Bt=function(e){var t=e.title;return r.a.createElement("div",{className:"progress-cover"},r.a.createElement("div",{className:"progress"},r.a.createElement("div",{className:"content"},r.a.createElement(Mt.a,{className:"circular"}),r.a.createElement("span",{className:"title"},t,"..."))))},Vt=r.a.memo(Bt),Gt=(a(225),{beginTimestamp:0,duration:0,roomToken:"",mediaURL:"",isPlaying:!1,progress:0,player:null,currentTime:0,phase:Ke.PlayerPhase.Pause,isFirstScreenReady:!1,isPlayerSeeking:!1,seenMessagesLength:0,isChatOpen:!1,isVisible:!1,replayFail:!1}),Ft=new(function(){function e(){Object(C.a)(this,e),this.subject=void 0,this.state=void 0,this.subject=null,this.state=null}return Object(j.a)(e,[{key:"initialize",value:function(){this.subject=new x.a,this.state=Gt,this.subject.next(this.state)}},{key:"subscribe",value:function(e){this.initialize(),this.subject&&this.subject.subscribe(e)}},{key:"unsubscribe",value:function(){this.subject&&this.subject.unsubscribe(),this.state=null,this.subject=null}},{key:"commit",value:function(e){this.subject&&this.subject.next(e)}},{key:"setPlayer",value:function(e){this.state&&(this.state=Object(p.a)({},this.state,{player:e}),this.commit(this.state))}},{key:"setCurrentTime",value:function(e){this.state&&(this.state=Object(p.a)({},this.state,{currentTime:e}),this.commit(this.state))}},{key:"updatePlayerStatus",value:function(e){this.state&&(this.state=Object(p.a)({},this.state,{isPlaying:e}),!this.state.isPlaying&&this.state.player&&this.state.player.seekToScheduleTime(0),this.commit(this.state))}},{key:"updateProgress",value:function(e){this.state&&(this.state=Object(p.a)({},this.state,{progress:e}),this.commit(this.state))}},{key:"setReplayFail",value:function(e){this.state&&(this.state=Object(p.a)({},this.state,{replayFail:e}),this.commit(this.state))}},{key:"updatePhase",value:function(e){if(this.state){var t=this.state.isPlaying;e===Ke.PlayerPhase.Playing&&(t=!0),e!==Ke.PlayerPhase.Ended&&e!==Ke.PlayerPhase.Pause||(t=!1),this.state=Object(p.a)({},this.state,{phase:e,isPlaying:t}),this.commit(this.state)}}},{key:"loadFirstFrame",value:function(){this.state&&(this.state=Object(p.a)({},this.state,{isFirstScreenReady:!0}),this.commit(this.state))}},{key:"joinRoom",value:function(){var e=Object(ae.a)(te.a.mark((function e(t){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tt(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}()),Jt=r.a.createContext({}),zt=function(){var e=r.a.useState(Gt),t=Object(v.a)(e,2),a=t[0],n=t[1],c=Object(s.h)(),o=c.uuid,i=c.startTime,u=c.endTime,l=c.mediaUrl,m=Object(s.g)(),d=new URLSearchParams(m.search),h=d.get("rid"),f=d.get("senderId");if(r.a.useEffect((function(){return Ft.subscribe((function(e){n(e)})),function(){Ft.unsubscribe()}}),[]),!o||!h||!i||!u||!l)return Fe.state={reason:U("error.components.paramsEmpty",{reason:"uuid, rid, startTime, endTime, mediaUrl"})},r.a.createElement(s.a,{to:"/404"});var p=a;return r.a.createElement(Jt.Provider,{value:p},r.a.createElement(Yt,{rid:h,senderId:f,whiteboardUUID:o,startTime:+i,endTime:+u,mediaUrl:l}))},Yt=function(e){var t=e.whiteboardUUID,a=(e.rid,e.senderId,e.startTime),c=e.endTime,o=e.mediaUrl,s=r.a.useContext(Jt),i=Object(n.useMemo)((function(){return Ft.state&&Ft.state.player?Ft.state.player:null}),[Ft.state]),u=function(){if(Ft.state&&i)if(i.phase!==Ke.PlayerPhase.Playing){if(i.phase!==Ke.PlayerPhase.WaitingFirstFrame&&i.phase!==Ke.PlayerPhase.Pause)return i.phase===Ke.PlayerPhase.Ended?(i.seekToScheduleTime(0),void i.play()):void 0;i.play()}else i.pause()},l=function(){s.player&&s.player.refreshViewSize()},m=function(e){"Space"===e.code&&s.player&&d(s.player)},d=function(e){switch(e.phase){case Ke.PlayerPhase.WaitingFirstFrame:case Ke.PlayerPhase.Pause:e.play();break;case Ke.PlayerPhase.Playing:e.pause();break;case Ke.PlayerPhase.Ended:e.seekToScheduleTime(0)}},h=Object(n.useMemo)((function(){return a&&c?Math.abs(+a-+c):0}),[a,c]),f=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){f.current=!0}}),[]),Object(n.useEffect)((function(){return window.addEventListener("resize",l),window.addEventListener("keydown",m),t&&a&&c&&Ft.joinRoom(t).then((function(e){var n=e.roomToken;at(st.client,{beginTimestamp:+a,duration:h,room:t,mediaURL:be(o),roomToken:n},{onCatchErrorWhenRender:function(e){e&&console.warn(e),I.showToast({message:U("toast.replay_failed"),type:"notice"})},onCatchErrorWhenAppendFrame:function(e){e&&console.warn(e),I.showToast({message:U("toast.replay_failed"),type:"notice"})},onPhaseChanged:function(e){Ft.updatePhase(e)},onLoadFirstFrame:function(){Ft.loadFirstFrame()},onSliceChanged:function(){},onPlayerStateChanged:function(e){},onStoppedWithError:function(e){e&&console.warn(e),I.showToast({message:U("toast.replay_failed"),type:"notice"}),Ft.setReplayFail(!0)},onScheduleTimeChanged:function(e){f.current||Ft.setCurrentTime(e)}}).then((function(e){e&&(Ft.setPlayer(e),e.bindHtmlElement(document.getElementById("whiteboard")))}))})),function(){window.removeEventListener("resize",l),window.removeEventListener("keydown",l)}}),[]);var p=Object(n.useMemo)((function(){return Et()(h).format("mm:ss")}),[h]),v=Object(n.useMemo)((function(){return Et()(s.currentTime).format("mm:ss")}),[s.currentTime]),b=Object(n.useCallback)((function(){return i?i.phase===Ke.PlayerPhase.Playing?null:r.a.createElement("div",{className:"player-cover"},i.phase===Ke.PlayerPhase.Buffering?r.a.createElement(Bt,{title:U("replay.loading")}):null,i.phase===Ke.PlayerPhase.Pause||i.phase===Ke.PlayerPhase.Ended||i.phase===Ke.PlayerPhase.WaitingFirstFrame?r.a.createElement("div",{className:"play-btn",onClick:u}):null):r.a.createElement(Bt,{title:U("replay.loading")})}),[i,s]);return r.a.createElement("div",{className:"replay"},r.a.createElement("div",{className:"player-container"},r.a.createElement(b,null),r.a.createElement("div",{className:"player"},r.a.createElement("div",{className:"agora-logo"}),r.a.createElement("div",{id:"whiteboard",className:"whiteboard"}),r.a.createElement("div",{className:"video-menu"},r.a.createElement("div",{className:"control-btn"},r.a.createElement("div",{className:"btn ".concat(i&&i.phase===Ke.PlayerPhase.Playing?"paused":"play"),onClick:u})),r.a.createElement("div",{className:"progress"},r.a.createElement(Re.a,{className:"custom-video-progress",value:s.currentTime,onMouseDown:function(){Ft.state&&Ft.state.player&&(Ft.state.player.pause(),f.current=!0)},onMouseUp:function(){if(Ft.state&&Ft.state.player){var e=Ft.state.player;e.seekToScheduleTime(s.currentTime),e.play(),f.current=!1}},onChange:function(e,t){Ft.setCurrentTime(t),Ft.updateProgress(t)},min:0,max:h,"aria-labelledby":"continuous-slider"}),r.a.createElement("div",{className:"time"},r.a.createElement("div",{className:"current_duration"},v),"/",r.a.createElement("div",{className:"video_duration"},p)))))),r.a.createElement("div",{className:"video-container"},r.a.createElement("div",{className:"video-player"},r.a.createElement("video",{id:"white-sdk-video-js",className:"video-js video-layout",style:{width:"100%",height:"100%",objectFit:"cover"}})),r.a.createElement("div",{className:"chat-holder chat-board chat-messages-container"})))};a(226);function Zt(){var e=dt(),t=e.me,a=e.course;return{teacher:Object(n.useMemo)((function(){if(a.teacherId&&t.uid){var n=xe.state.users.get(""+a.teacherId);if(n){if(t.uid===a.teacherId)return Object(p.a)({},e.rtc.localStream,{account:n.account,video:n.video,audio:n.audio,local:!0});var r=e.rtc.users.get(+a.teacherId);if(!r)return null;var c=e.rtc.remoteStreams.get(r);return c?Object(p.a)({},c,{account:n.account,video:n.video,audio:n.audio}):{streamID:r,account:n.account,video:n.video,audio:n.audio}}}}),[a,t.uid,e.rtc.users,e.rtc.remoteStreams,e.rtc.localStream]),students:Object(n.useMemo)((function(){var n=xe.state.users;if(!t.uid||0===n.count())return[];var r=a.teacherId,c=e.rtc.users.filter((function(e){return e!==+r&&e!==+t.uid&&7!==e})),o=[],s=n.get(t.uid);if("student"===t.role&&s&&e.rtc.localStream){var i=Object(p.a)({},e.rtc.localStream,{account:s.account,video:s.video,audio:s.audio,local:!0});o.push(i)}var u,l=Object(X.a)(c);try{for(l.s();!(u=l.n()).done;){var m=u.value,d=n.get(""+m),h=e.rtc.remoteStreams.get(+m);if(d){var f={streamID:m,account:d.account,video:d.video,audio:d.audio};h&&(f=Object(p.a)({},h,{streamID:m,account:d.account,video:d.video,audio:d.audio})),o.push(f)}}}catch(v){l.e(v)}finally{l.f()}return o}),[a,t.uid,e.rtc.users,e.rtc.remoteStreams,e.rtc.localStream]),sharedStream:Object(n.useMemo)((function(){if(e.rtc.localSharedStream)return Object(p.a)({},e.rtc.localSharedStream,{video:1,audio:1});var t=e.rtc.remoteStreams.get(7);return t?Object(p.a)({},t,{video:1,audio:1}):null}),[e.rtc.remoteStreams,e.rtc.localSharedStream]),currentHost:Object(n.useMemo)((function(){if(!a.linkId)return null;var n=""+a.linkId,r=e.users.get(n);if(!r)return null;if(t.uid===n){if(e.rtc.localStream)return Object(p.a)({},e.rtc.localStream,{account:r.account,video:r.video,audio:r.audio,local:!0,streamID:+t.uid})}else{var c=a.linkId,o=e.users.get(""+c);if(c&&o){var s=e.rtc.remoteStreams.get(c);if(s)return Object(p.a)({},s,{account:o.account,video:o.video,audio:o.audio,streamID:+c})}}return null}),[a,t.uid,e.rtc.remoteStreams,e.rtc.localStream]),onPlayerClick:function(){var e=Object(ae.a)(te.a.mark((function e(t,a,n){var r,c,o,s,i,u;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(" click player ",t,a,n),r=xe.state.me,xe.state.rtm.joined&&r.uid){e.next=4;break}return e.abrupt("return",console.warn("please confirm joined rtm"));case 4:if(c=xe.state.users.get(n),console.log("targetUser : ",c),c){e.next=8;break}return e.abrupt("return");case 8:if(o=c.uid,console.log(" click >>> targetUid: ",o," type: ",t," streamID: ",a," uid: ",n),s=Boolean(c.video),i=Boolean(c.audio),u=Boolean(c.chat),"video"!==t){e.next=22;break}if(!s){e.next=19;break}return e.next=17,xe.mute(o,"video");case 17:e.next=21;break;case 19:return e.next=21,xe.unmute(o,"video");case 21:return e.abrupt("return");case 22:if("audio"!==t){e.next=31;break}if(!i){e.next=28;break}return e.next=26,xe.mute(o,"audio");case 26:e.next=30;break;case 28:return e.next=30,xe.unmute(o,"audio");case 30:return e.abrupt("return");case 31:if("chat"!==t){e.next=40;break}if(!u){e.next=37;break}return e.next=35,xe.mute(o,"chat");case 35:e.next=39;break;case 37:return e.next=39,xe.unmute(o,"chat");case 39:return e.abrupt("return");case 40:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()}}var Kt=function(){var e=document.querySelector(".video-marquee .agora-video-view");if(e){var t=e.clientWidth,a=document.querySelectorAll(".video-marquee .agora-video-view").length,n=document.querySelector(".video-marquee-mask");if(t&&n)if(n.clientWidth<=t*a)return!0}return!1};var qt=r.a.memo((function(){var e=Zt(),t=e.teacher,a=e.students,c=e.onPlayerClick,o=Object(n.useRef)(null),s=function(e,t){e.scrollLeft+=t*e.childNodes[1].offsetWidth},i=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){i.current=!0}}),[]);var u=Object(n.useState)(!1),l=Object(v.a)(u,2),m=l[0],d=l[1];return Object(n.useLayoutEffect)((function(){a.length&&!i.current&&d(Kt())}),[a]),Object(n.useEffect)((function(){return window.addEventListener("resize",(function(e){!i.current&&d(Kt())})),function(){window.removeEventListener("resize",(function(){}))}}),[]),r.a.createElement("div",{className:"video-marquee-container"},r.a.createElement("div",{className:"main"},t?r.a.createElement(ft,{role:"teacher",domId:"dom-".concat(t.streamID),id:"".concat(t.streamID),streamID:t.streamID,stream:t.stream,account:t.account,audio:Boolean(t.audio),video:Boolean(t.video),local:Boolean(t.local),handleClick:c}):r.a.createElement(ft,{role:"teacher",account:"teacher",video:!0,audio:!0,streamID:0})),r.a.createElement("div",{className:"video-marquee-mask"},r.a.createElement("div",{className:"video-marquee",ref:o},m?r.a.createElement("div",{className:"scroll-btn-group"},r.a.createElement("div",{className:"icon icon-left",onClick:function(e){s(o.current,1)}}),r.a.createElement("div",{className:"icon icon-right",onClick:function(e){s(o.current,-1)}})):null,a.map((function(e,t){return r.a.createElement(ft,{role:"student",domId:"dom-".concat(e.streamID),key:"".concat(t).concat(e.streamID),id:"".concat(e.streamID),account:e.account,streamID:e.streamID,stream:e.stream,video:e.video,audio:e.audio,local:e.local,handleClick:c})})))))}));a(227);function Ht(e){var t=e.room,a=e.className,c=e.loading,o=Object(n.useRef)(null);return Object(n.useEffect)((function(){if(t&&st.state.room&&o.current)return t.bindHtmlElement(o.current),st.updateRoomState(),window.addEventListener("resize",(function(e){null!==st.state.room&&(st.state.room.moveCamera({centerX:0,centerY:0}),st.state.room.refreshViewSize())})),function(){st.state.room&&st.state.room.bindHtmlElement(null),window.removeEventListener("resize",(function(e){}))}}),[t,o]),r.a.createElement("div",{className:"whiteboard"},c||!t?r.a.createElement(Bt,{title:U("whiteboard.loading")}):null,r.a.createElement("div",{ref:o,id:"whiteboard",className:"whiteboard-canvas ".concat(a)}))}var Qt=function(e){var t=function(t){e.onClick(t,e.name)};return e.text?r.a.createElement("div",{className:"control-btn control-".concat(e.name),onClick:t},r.a.createElement("div",{className:"btn-icon ".concat(e.name," ").concat(e.active?"active":""),"data-name":e.name}),r.a.createElement("div",{className:"control-text"},e.text)):r.a.createElement(V,{data:e.name,onClick:t,className:"items ".concat(e.name," ").concat(e.active?"active":"")})};function $t(e){var t=e.sharing,a=e.isHost,c=e.current,o=(e.currentPage,e.totalPage,e.onClick),s=e.role,i=e.notice,u=Object(n.useRef)(!1),l=function(){var e=Object(ae.a)(te.a.mark((function e(t,a){var n,r,c,o,s,i,l,m;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=xe.state,r=n.me,!u.current&&r.uid){e.next=5;break}return e.abrupt("return");case 5:if(!st.state.recording){e.next=21;break}if(!(+Et()(st.state.startTime).add(15,"seconds")>=+Date.now())||(I.showToast({type:"netlessClient",message:U("toast.recording_too_short")}),0)){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,st.stopRecording();case 10:if(c=e.sent,I.showToast({type:"recording",message:U("toast.stop_recording")}),!st.state.endTime||!st.state.startTime){e.next=19;break}return o=st.clearRecording(),s=o.endTime,i=o.startTime,l=o.roomUUID,e.next=16,xe.rtmClient.sendChannelMessage(JSON.stringify({account:r.account,url:be(c),link:"/replay/".concat(l,"/").concat(i,"/").concat(s,"/").concat(c)}));case 16:return m={account:r.account,id:r.uid,link:"/replay/".concat(l,"/").concat(i,"/").concat(s,"/").concat(c),text:"",ts:+Date.now()},xe.updateChannelMessage(m),e.abrupt("return");case 19:e.next=24;break;case 21:return e.next=23,st.startRecording();case 23:I.showToast({type:"recording",message:U("toast.start_recording")});case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(0),e.t0.recordingErr&&I.showToast({type:"recordingErr",message:U("toast.recording_failed",{reason:e.t0.recordingErr.message})});case 29:case"end":return e.stop()}}),e,null,[[0,26]])})));return function(t,a){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"controls-container"},r.a.createElement("div",{className:"controls"},t||"teacher"!==s?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(Qt,{name:"new_page",active:!0,onClick:o})),"teacher"===s?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qt,{name:st.state.recording?"stop_recording":"recording",onClick:function(e,t){l(e,t).then((function(){})).catch(console.warn)},active:!1}),r.a.createElement(Qt,{name:t?"quit_screen_sharing":"screen_sharing",onClick:o,active:!1,text:t?"stop sharing":""})):null,"student"===s?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qt,{name:a?"hands_up_end":"hands_up",onClick:o,active:!1,text:""})):null),r.a.createElement("div",{className:"interactive"},i?r.a.createElement(Qt,{name:i.reason,onClick:o,active:i.reason===c}):null))}var Xt,ea,ta=function(e){e.room,e.uuid,e.roomToken,e.onProgress;var t=e.onFailure,a=e.onSuccess,n=function(){var e=Object(ae.a)(te.a.mark((function e(n){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{n.currentTarget.files[0]&&a&&a()}catch(r){t&&t(r),console.warn(r)}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=Object(ae.a)(te.a.mark((function e(a){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{a.currentTarget.files[0]}catch(n){t&&t(n),console.warn(n)}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=function(){var e=Object(ae.a)(te.a.mark((function e(a){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{a.currentTarget.files[0]}catch(n){t&&t(n),console.warn(n)}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s=function(){var e=Object(ae.a)(te.a.mark((function e(t){return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"upload-btn"},r.a.createElement("div",{className:"upload-items"},r.a.createElement("label",{htmlFor:"upload-image"},r.a.createElement("div",{className:"upload-image-resource"}),r.a.createElement("div",{className:"text-container"},r.a.createElement("div",{className:"title"},"Convert Picture"),r.a.createElement("div",{className:"description"},"bmp, jpg, png, gif"))),r.a.createElement("input",{id:"upload-image",accept:"image/*,.bmp,.jpg,.png,.gif",onChange:o,type:"file"})),r.a.createElement("div",{className:"slice-dash"}),r.a.createElement("div",{className:"upload-items"},r.a.createElement("label",{htmlFor:"upload-dynamic"},r.a.createElement("div",{className:"upload-dynamic-resource"}),r.a.createElement("div",{className:"text-container"},r.a.createElement("div",{className:"title"},"Convert to Webpage"),r.a.createElement("div",{className:"description"},"pptx only support"))),r.a.createElement("input",{id:"upload-dynamic",accept:".pptx",onChange:n,type:"file"})),r.a.createElement("div",{className:"slice-dash"}),r.a.createElement("div",{className:"upload-items"},r.a.createElement("label",{htmlFor:"upload-static"},r.a.createElement("div",{className:"upload-static-resource"}),r.a.createElement("div",{className:"text-container"},r.a.createElement("div",{className:"title"},"Convert to picture"),r.a.createElement("div",{className:"description"},"pptx, word, pdf support"))),r.a.createElement("input",{id:"upload-static",accept:".doc,.docx,.ppt,.pptx,.pdf",onChange:c,type:"file"})),r.a.createElement("div",{className:"slice-dash"}),r.a.createElement("div",{className:"upload-items"},r.a.createElement("label",{htmlFor:"upload-video"},r.a.createElement("div",{className:"upload-static-resource"}),r.a.createElement("div",{className:"text-container"},r.a.createElement("div",{className:"title"},"Upload audio/video"),r.a.createElement("div",{className:"description"},"mp4,mp3"))),r.a.createElement("input",{id:"upload-video",accept:".mp4,.mp3",onChange:s,type:"file"})))},aa=function(e){var t=e.onClose,a=e.items,n=e.active,c=e.onClick;return r.a.createElement("div",{className:"resource-menu-container"},r.a.createElement("div",{className:"menu-header"},r.a.createElement("div",{className:"menu-title"},"Course Document Center"),r.a.createElement("div",{className:"menu-close",onClick:t})),r.a.createElement("div",{className:"menu-body"},r.a.createElement("div",{className:"menu-items"},a.map((function(e,t){return r.a.createElement("div",{key:t,className:"item ".concat(n===t?"active":""," ").concat(t," ").concat(n),onClick:function(){c(e.rootPath)}},r.a.createElement("div",{className:"cover-item ".concat(e.file.type.match(/ppt/)?"ppt-cover":"doc-cover")}),r.a.createElement("div",{className:"title"},e.file.name))})))))};a(77);!function(e){e.dynamic="dynamic",e.static="static",e.init="init"}(Xt||(Xt={})),function(e){e[e.Uploading=0]="Uploading",e[e.Converting=1]="Converting"}(ea||(ea={}));a(228);var na=function(e){var t=e.type,a=e.title;return r.a.createElement("div",{className:"notice-container ".concat(t)},r.a.createElement("span",{className:"icon-".concat(t)}),r.a.createElement("span",{className:"title"},a))},ra=(r.a.createContext({}),r.a.memo((function(){var e=mt().uploadNotice,t=r.a.useRef([]),a=Object(n.useState)([]),c=Object(v.a)(a,2),o=c[0],s=c[1],i=Object(n.useRef)(null);return Object(n.useEffect)((function(){o.length>0&&null===i.current&&(i.current=setTimeout((function(){t.current.shift(),s(Object(Le.a)(t.current)),i.current=null}),1500))}),[o]),Object(n.useEffect)((function(){e.title&&e.type&&t.current&&(t.current.push(Object(p.a)({},e,{key:+Date.now()})),s(Object(Le.a)(t.current)))}),[e]),r.a.createElement("div",{className:"upload-notice"},o.map((function(e,t){return r.a.createElement(na,{key:"".concat(t).concat(e.key),type:e.type,title:e.title})})))}))),ca=(a(229),r.a.memo((function(e){var t=e.handleClick,a=e.children,c=dt(),o=lt().whiteboardState,i=c.me.role,u=o.room,l=c.me,m=c.course,d=c.rtm,h=Object(n.useRef)(!1),f=Object(n.useState)(""),p=Object(v.a)(f,2),b=p[0],g=p[1],_=Zt().sharedStream,E=c.rtc.shared;Object(n.useEffect)((function(){if(E){var e=xe.rtcClient;if(!E);var t=e,a=document.getElementById("3dviewer");if(null!=a){var n=a.contentWindow;if(null!=n){var r=n.document.getElementById("player");if(null!=r){var c=r.lastChild;if(null!=c){var o=c.captureStream(60);return t.start3dViewerShare("",o).then((function(){t.shareClient.on("onTokenPrivilegeWillExpire",(function(e){t.shareClient.renewToken("")})),t.shareClient.on("onTokenPrivilegeDidExpire",(function(e){t.shareClient.renewToken("")})),t.shareClient.on("stopScreenSharing",(function(e){console.log("stop screen share",e),t.stopScreenShare().then((function(){I.showToast({message:U("toast.canceled_screen_share"),type:"notice"}),xe.setScreenShare(!1)})).catch(console.warn).finally((function(){console.log("[agora-web] stop share")}))}));var e=t.shareClient._localStream,a=new yt(e,e.getId(),!0);xe.addLocalSharedStream(a)})).catch((function(e){xe.setScreenShare(!1),"error"===e.type&&"NotAllowedError"===e.msg&&I.showToast({message:U("toast.canceled_screen_share"),type:"notice"}),"error"===e.type&&"PERMISSION_DENIED"===e.msg&&I.showToast({message:U("toast.screen_sharing_failed",{reason:e.msg}),type:"notice"}),console.warn(e)})).finally((function(){console.log("[agora-web] start share")})),function(){console.log("before shared change",E),E&&t.stopScreenShare().then((function(){xe.setScreenShare(!1)})).catch(console.warn).finally((function(){console.log("[agora-web] stop share")}))}}}}}}}),[E]);var y=Object(n.useMemo)((function(){return+xe.state.me.uid===+xe.state.course.linkId}),[xe.state.me.uid,xe.state.course.linkId]),k=Object(s.g)(),O=Object(n.useMemo)((function(){return o.scenes.get(o.currentScenePath)}),[o.scenes,o.currentScenePath]),w=Object(n.useMemo)((function(){return O?O.totalPage:0}),[O]),C=Object(n.useMemo)((function(){return O?O.currentPage+1:0}),[O]),j=function(e){if(O&&u){var t=u.state.sceneState.index+1,a=u.state.sceneState.scenePath,n="/".concat((/\/([^/]*)\//g.exec(a),"aria"===RegExp.$1?"":RegExp.$1));u.putScenes(n,[{}],t),u.setSceneIndex(t),st.updateRoomState()}},x=function(e,t){if(!h.current&&O&&u){var a=e-1;if(!(a<0||a>=O.totalPage)){if(t)return u.setSceneIndex(a),void st.updateRoomState();"dynamic"===O.type?a>O.currentPage?(u.pptNextStep(),console.log("room.pptNextStep")):(u.pptPreviousStep(),console.log("room.pptPreviousStep")):(u.setSceneIndex(a),console.log("room.setSceneIndex",a)),st.updateRoomState()}}},S=Object(n.useMemo)((function(){return"teacher"===l.role||!(!k.pathname.match(/big-class/)||"student"!==l.role)}),[]),T=[{name:"selector"},{name:"pencil"},{name:"rectangle"},{name:"ellipse"},{name:"text"},{name:"eraser"},{name:"color_picker"},{name:"add"},{name:"upload"},{name:"hand_tool"}],N=(Object(n.useMemo)((function(){return T.filter((function(e){return"teacher"===i?e:-1===["add","folder","upload"].indexOf(e.name)?"hand_tool"===e.name?!m.lockBoard:e:void 0}))}),[m.lockBoard]),Object(n.useMemo)((function(){if(k.pathname.match("small-class|big-class")){if("teacher"===l.role)return"drawable";if("student"===l.role)return console.log("agora pathname: >>>>>>> ",k.pathname,l.grantBoard,l.role,Boolean(l.grantBoard)),Boolean(l.grantBoard)?"drawable":"panel"}return"drawable"}),[l.role,l.grantBoard,k])),P=Object(n.useState)("drawable"===N?"pencil":""),A=Object(v.a)(P,2),R=A[0],M=A[1],D=Object(n.useState)(""),L=Object(v.a)(D,2),W=L[0],B=(L[1],Object(n.useRef)(!1));Object(n.useEffect)((function(){return function(){B.current=!0,st.destroy().then((function(){console.log("destroy whiteboard")})).catch(console.warn)}}),[]),Object(n.useEffect)((function(){d.joined&&(B.current||st.state.room||(B.current=!0,st.join({rid:xe.state.course.rid,uid:l.boardId,location:k.pathname,userPayload:{userId:xe.state.me.uid,identity:"teacher"===xe.state.me.role?"host":"guest"}}).then((function(){console.log("join whiteboard success")})).catch(console.warn).finally((function(){B.current=!1}))),!B.current&&m.boardId&&l.boardId!==m.boardId&&st.state.room&&(B.current=!0,st.join({rid:xe.state.course.rid,uid:m.boardId,location:k.pathname,userPayload:{userId:xe.state.me.uid,identity:"teacher"===xe.state.me.role?"host":"guest"}}).then((function(){console.log("rejoin whiteboard success")})).catch(console.warn).finally((function(){B.current=!1}))))}),[d.joined,l.boardId,m.boardId]);var V=Object(n.useState)(""),G=Object(v.a)(V,2),F=G[0],J=G[1],z=Object(n.useState)(""),Y=Object(v.a)(z,2),Z=Y[0],K=Y[1];Object(n.useEffect)((function(){console.log("[mediaboard] uploadPhase: ",F," convertPhase: ",Z)}),[F,Z]);var q=Object(n.useCallback)((function(){return"upload"===R&&u?r.a.createElement(ta,{room:u,uuid:u.uuid,roomToken:u.roomToken,onProgress:function(e,t){console.log("[onProgress] phase: ",e," percent: ",t),e!==ea.Uploading?e!==ea.Converting||(t<1?!Z&&K("converting"):K("convert_success")):t<1?!F&&J("uploading"):J("upload_success")},onSuccess:function(){console.log("on success")},onFailure:function(e){"uploading"!==F?"converting"!==Z||K("convert_failure"):J("upload_failure")}}):null}),[R,u]);Object(n.useEffect)((function(){"upload_success"===F&&I.showUploadNotice({title:U("room.upload_success"),type:"ok"}),"convert_failure"===F&&I.showUploadNotice({title:U("room.upload_failure"),type:"error"})}),[F]),Object(n.useEffect)((function(){"convert_success"===Z&&I.showUploadNotice({title:U("room.convert_success"),type:"ok"}),"convert_failure"===Z&&I.showUploadNotice({title:U("room.convert_failure"),type:"error"})}),[Z]),Object(n.useEffect)((function(){l.role&&u&&("teacher"===l.role&&(xe.state.course.lockBoard?u.setViewMode(Ke.ViewMode.Broadcaster):u.setViewMode(Ke.ViewMode.Freedom)),"student"===l.role&&(xe.state.course.lockBoard?(u.handToolActive=!1,u.disableCameraTransform=!0,u.disableDeviceInputs=!0):(u.disableCameraTransform=!1,u.disableDeviceInputs=!1)))}),[u,xe.state.course.lockBoard,xe.state.me.role]);var H=mt(),Q=(o.scale&&o.scale,Object(n.useCallback)((function(){return"uploading"===F?r.a.createElement(Vt,{title:U("room.uploading")}):"converting"===Z?r.a.createElement(Vt,{title:U("room.converting")}):null}),[F,Z]));if(o.room&&o.room.state.memberState.strokeColor){var $=o.room.state.memberState.strokeColor;({r:$[0],g:$[1],b:$[2]})}Object(n.useEffect)((function(){if(u){if("panel"===N)return u.disableDeviceInputs=!0,void(u.disableCameraTransform=!0);u.disableDeviceInputs=!1,u.disableCameraTransform=!1}}),[N,u]);return r.a.createElement("div",{className:"media-board ".concat(N)},"teacher"===l.role&&u?r.a.createElement("iframe",{className:"frame_3d",id:"3dviewer",src:"./newhouse/index.html",frameBorder:"no"}):null,_?r.a.createElement("div",{className:"media-board ".concat(N)},"teacher"===l.role&&u?null:r.a.createElement(ft,{id:"".concat(_.streamID),domId:"shared-".concat(_.streamID),className:"screen-sharing",streamID:_.streamID,stream:_.stream,video:!0,audio:!0,local:_.local})):r.a.createElement(Ht,{loading:o.loading,className:W,room:u}),r.a.createElement("div",{className:"layer"},r.a.createElement(q,null),a||null),S?r.a.createElement($t,{notice:H.notice,role:i,sharing:Boolean(_),current:b,currentPage:C,totalPage:w,isHost:y,onClick:function(e,a){(g(a),console.log("[page-tool] click ",a),"first_page"===a&&x(1,!0),"last_page"===a&&x(w,!0),"prev_page"===a&&x(C-1),"next_page"===a&&x(C+1),"new_page"===a&&j(),"screen_sharing"===a)&&(j(),xe.setScreenShare(!0));"quit_screen_sharing"===a&&xe.setScreenShare(!1),"peer_hands_up"===a&&(I.showDialog({type:"apply",message:"".concat(I.state.notice.text)}),g("")),t&&t(a)}}):null,"folder"===R&&o.room?r.a.createElement(aa,{active:o.activeDir,items:o.dirs,onClick:function(e){u&&(u.setScenePath(e),u.setSceneIndex(0),st.updateRoomState())},onClose:function(e){M("")}}):null,r.a.createElement(ra,null),r.a.createElement(Q,null))}))),oa=(a(230),function(e){var t=e.nickname,a=e.content,n=e.link,c=e.sender,o=e.children,s=e.ref,u=e.className,l=dt(),m=r.a.useMemo((function(){return n&&l.course.rid?r.a.createElement(i.b,{to:"".concat(n,"?rid=").concat(l.course.rid,"&senderId=").concat(l.me.uid),target:"_blank"},"course recording"):n||a}),[a,n,l.course.rid]);return r.a.createElement("div",{ref:s,className:"message ".concat(c?"sent":"receive"," ").concat(u||"")},r.a.createElement("div",{className:"nickname"},t),r.a.createElement("div",{className:"content"},m),o||null)});a(231);var sa=/^\s+/,ia=function(e){return e.replace(sa,"")};function ua(e){var t=e.messages,a=e.value,c=e.sendMessage,o=e.handleChange,s=function(){var e=Object(n.useRef)(!1);Object(n.useEffect)((function(){return e.current=!1,function(){e.current=!0}}),[]);var t=xe.state.me,a=xe.state.course,r="teacher"===t.role,c=Boolean(a.muteChat),o=Boolean(t.chat),s=Object(n.useMemo)((function(){return!("student"!==t.role||!c&&o)}),[c,o,t.role]);return{chat:o,disableChat:s,muteControl:r,muteChat:c,handleMute:function(t){e.current||(e.current=!0,xe.updateMe({muteChat:"mute"===t?1:0}).then((function(){console.log("update success")})).catch(console.warn).finally((function(){e.current=!1})))}}}(),i=s.handleMute,u=s.disableChat,l=s.muteControl,m=s.muteChat,d=Object(n.useRef)(null);Object(n.useEffect)((function(){var e;(e=d.current).scrollTop=e.scrollHeight}),[t]);var h=dt();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"chat-messages-container"},r.a.createElement("div",{className:"chat-messages",ref:d},t.map((function(e,t){return r.a.createElement(oa,{key:t,nickname:e.account,content:e.text,link:e.link,sender:e.id===h.me.uid})})))),r.a.createElement("div",{className:"message-panel"},l?r.a.createElement("div",{className:"icon ".concat(m?"icon-chat-off":"icon-chat-on"),onClick:function(){i(m?"unmute":"mute")}}):null,r.a.createElement(F.a,{disabled:u,value:a,placeholder:U(u?"chat.banned":"chat.placeholder"),disableUnderline:!0,className:"message-input",onKeyPress:function(){var e=Object(ae.a)(te.a.mark((function e(t){var n;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=6;break}if(n=ia(a),e.t0=n.length>0,!e.t0){e.next=6;break}return e.next=6,c(n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onChange:o}),r.a.createElement(E,{className:"chat-panel-btn",name:U("chat.send"),onClick:function(){var e=Object(ae.a)(te.a.mark((function e(t){var n;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=ia(a),e.t0=n.length>0,!e.t0){e.next=5;break}return e.next=5,c(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})))}a(232);function la(e){var t=e.value,a=e.icon,n=e.id,c=e.type,o=e.onClick;return r.a.createElement("div",{className:"items"},r.a.createElement(V,{className:"icon-".concat(a,"-").concat(t?"on":"off"),onClick:function(e){o(e,n,c)}}))}function ma(e){var t=e.list,a=(e.role,dt().me),c=Object(n.useRef)(!1),o=function(e,t,n){if(xe.state&&a){var r=xe.state.users.get(t);if(r&&!c.current){var o=Boolean(Object(S.get)(r,n));c.current=!0,o?xe.mute(r.uid,n).then((function(){})).catch(console.warn).finally((function(){c.current=!1})):xe.unmute(r.uid,n).then((function(){})).catch(console.warn).finally((function(){c.current=!1}))}}};return r.a.createElement("div",{className:"student-list"},t.map((function(e,t){return r.a.createElement("div",{key:t,className:"item"},r.a.createElement("div",{className:"nickname"},e.account),r.a.createElement("div",{className:"attrs-group"},r.a.createElement(la,{type:"grantBoard",id:e.uid,value:Boolean(e.grantBoard),icon:"connect",onClick:o}),r.a.createElement(la,{type:"chat",id:e.uid,value:Boolean(e.chat),icon:"chat",onClick:o}),r.a.createElement(la,{type:"audio",id:e.uid,value:Boolean(e.audio),icon:"audio",onClick:o}),r.a.createElement(la,{type:"video",id:e.uid,value:Boolean(e.video),icon:"video",onClick:o})))})))}function da(){var e=Object(n.useState)(""),t=Object(v.a)(e,2),a=t[0],r=t[1],c=dt(),o=c.course.roomName,s=c.me,i=s.role,u=Object(n.useMemo)((function(){return c.messages}),[c.messages]),l=xe.rtmClient,m=function(){var e=Object(ae.a)(te.a.mark((function e(t){var a;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l||!s.uid){e.next=10;break}if("teacher"===s.role||s.chat&&!Boolean(c.course.muteChat)){e.next=3;break}return e.abrupt("return",console.warn("chat already muted"));case 3:if("teacher"!==s.role||s.chat){e.next=5;break}return e.abrupt("return",console.warn("chat already muted"));case 5:return e.next=7,l.sendChannelMessage(JSON.stringify({account:s.account,content:t}));case 7:a={account:s.account,id:s.uid,text:t,ts:+Date.now()},xe.updateChannelMessage(a),r("");case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{list:Object(n.useMemo)((function(){if(!c.me.uid||!c.rtc.users.count()&&!c.rtc.localStream)return[];var e=c.users.get(c.me.uid),t=[];e&&t.push(e);var a,n=Object(X.a)(c.rtc.users);try{for(n.s();!(a=n.n()).done;){var r=a.value,o=c.users.get(""+r);o&&t.push(o)}}catch(s){n.e(s)}finally{n.f()}return t.filter((function(e){return"student"===e.role}))}),[c.me.uid,c.rtc.users,c.users,c.rtc.localStream]),role:i,messages:u,sendMessage:m,value:a,handleChange:function(e){r(e.target.value.slice(0,100))},roomName:o}}function ha(e){var t=da(),a=t.role,c=t.list,o=t.value,s=t.messages,i=t.sendMessage,u=t.handleChange,l=mt().active,m=Object(n.useState)(!0),d=Object(v.a)(m,2),h=d[0],f=d[1],p="chatroom"!==l?I.state.newMessageCount:0;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"".concat(h?"icon-collapse-off":"icon-collapse-on"," fixed"),onClick:function(e){f(!h)}}),h?r.a.createElement("div",{className:"small-class chat-board"},r.a.createElement("div",{className:"menu"},r.a.createElement("div",{onClick:function(){I.setActive("chatroom")},className:"item ".concat("chatroom"===l?"active":"")},U("room.chat_room"),"chatroom"!==l&&p>0?r.a.createElement("span",{className:"message-count ".concat(I.state.language)},p):null),r.a.createElement("div",{onClick:function(){I.setActive("studentList")},className:"item ".concat("studentList"===l?"active":"")},U("room.student_list"))),r.a.createElement("div",{className:"chat-container ".concat("chatroom"===l?"":"hide")},r.a.createElement(ua,{messages:s,value:o,sendMessage:i,handleChange:u})),r.a.createElement("div",{className:"student-container ".concat("chatroom"!==l?"":"hide")},r.a.createElement(ma,{role:a,list:c}))):null)}a(233);function fa(){return r.a.createElement("div",{className:"room-container"},r.a.createElement(qt,null),r.a.createElement("div",{className:"container"},r.a.createElement(ca,null),r.a.createElement(ha,{currentActive:"media"})))}function pa(e){return r.a.createElement("div",{className:"chat-board"},e.name?r.a.createElement("div",{className:"chat-roomname"},e.name,e.roomCount?"(".concat(e.roomCount,")"):null):null,r.a.createElement(ua,{messages:e.messages,value:e.value,sendMessage:e.sendMessage,handleChange:e.handleChange}))}function va(){var e=da(),t=e.value,a=e.messages,n=e.sendMessage,c=e.handleChange,o=Zt(),s=o.teacher,i=o.students,u=o.onPlayerClick;return r.a.createElement("div",{className:"room-container"},r.a.createElement(ca,null),r.a.createElement("div",{className:"live-board"},r.a.createElement("div",{className:"live-board"},r.a.createElement("div",{className:"users-board"},r.a.createElement("iframe",{id:"users-board",src:"./users/index.html",height:"600px",frameBorder:"no"})),r.a.createElement(pa,{messages:a,value:t,sendMessage:n,handleChange:c}))),r.a.createElement("div",{className:"video-board"},s?r.a.createElement(ft,{role:"teacher",streamID:s.streamID,stream:s.stream,domId:"".concat(s.streamID),id:"".concat(s.streamID),account:s.account,handleClick:u,video:s.video,audio:s.audio,local:s.local}):r.a.createElement(ft,{role:"teacher",account:"teacher",domId:"teacher",streamID:0,video:!0,audio:!0}),i[0]?r.a.createElement(ft,{role:"student",streamID:i[0].streamID,stream:i[0].stream,domId:"".concat(i[0].streamID),id:"".concat(i[0].streamID),handleClick:u,account:i[0].account,video:i[0].video,audio:i[0].audio,local:i[0].local}):r.a.createElement(ft,{role:"student",account:"student",domId:"student",streamID:0,video:!1,audio:!1})))}a(234);function ba(){var e=da(),t=e.value,a=e.messages,c=e.sendMessage,o=e.handleChange,s=e.role,i=e.roomName,u=dt(),l=u.me,m=u.rtm.memberCount,d=Zt(),h=d.teacher,f=d.currentHost,p=d.onPlayerClick,v=Object(n.useRef)(!1),b=Object(n.useRef)(!1);Object(n.useEffect)((function(){return v.current=!1,function(){v.current=!0,b.current=!0}}),[]);var g=Object(n.useRef)(!1);Object(n.useEffect)((function(){return function(){g.current=!0}}),[]);return r.a.createElement("div",{className:"room-container"},r.a.createElement("div",{className:"live-container"},r.a.createElement(ca,{handleClick:function(e){v.current||("hands_up"===e&&xe.state.course.teacherId&&(v.current=!0,xe.rtmClient.sendPeerMessage(xe.state.course.teacherId,{cmd:se.applyCoVideo}).then((function(e){console.log("peerMessage result ",e)})).catch(console.warn).finally((function(){v.current=!1}))),"hands_up_end"===e&&xe.state.course.teacherId&&(v.current=!0,xe.rtmClient.sendPeerMessage(xe.state.course.teacherId,{cmd:se.cancelCoVideo}).then((function(e){console.log("peerMessage result ",e)})).catch(console.warn).finally((function(){v.current=!1}))))}},r.a.createElement("div",{className:"video-container"},f?r.a.createElement(ft,{role:"teacher",streamID:f.streamID,stream:f.stream,domId:"".concat(f.streamID),id:"".concat(f.streamID),account:f.account,handleClick:p,close:"teacher"===l.role||+l.uid===f.streamID,handleClose:function(e,t){if("close"===e){if(!f||g.current)return;var a=xe.rtmClient,n=xe.rtcClient,r=xe.state.course.teacherId;if(console.log("close rtmClient: ",a,", rtcClient: ",n,", teacherUid: ",r,", lock :",g.current),f.streamID===+l.uid&&r){var c=new Promise((function(e,t){e(n.unpublishLocalStream())}));g.current=!0,v.current=!0,Promise.all([a.sendPeerMessage("".concat(r),{cmd:se.cancelCoVideo}),c]).then((function(){v.current=!1})).catch((function(e){throw v.current=!1,console.warn(e),e})).finally((function(){g.current=!1}))}r&&r===l.uid&&(v.current=!0,g.current=!0,Promise.all([a.sendPeerMessage("".concat(t),{cmd:se.cancelCoVideo}),xe.updateCourseLinkUid(0)]).then((function(){v.current=!1})).catch((function(e){v.current=!1,console.warn(e)})).finally((function(){g.current=!1})))}},video:f.video,audio:f.audio,local:f.local}):null))),r.a.createElement("div",{className:"live-board"},r.a.createElement("div",{className:"video-board"},h?r.a.createElement(ft,{role:"teacher",streamID:h.streamID,stream:h.stream,domId:"dom-".concat(h.streamID),id:"".concat(h.streamID),account:h.account,handleClick:p,audio:Boolean(h.audio),video:Boolean(h.video),local:Boolean(h.local)}):r.a.createElement(ft,{role:"teacher",account:"teacher",streamID:0,video:!0,audio:!0})),r.a.createElement(pa,{name:i,teacher:"teacher"===s,messages:a,mute:Boolean(u.course.muteChat),value:t,roomCount:m,sendMessage:c,handleChange:o})))}a(235);var ga=function(e){var t=e.children;return r.a.createElement("div",{className:"main-layout-container"},t)},_a=function(){var e=Object(s.f)();return r.a.createElement(ga,null,r.a.createElement("div",{className:"layout-content"},r.a.createElement("h1",null,"404"),r.a.createElement("h2",null,U("error.not_found")),r.a.createElement("a",{style:{cursor:"pointer"},onClick:function(){e.push("/")}},U("return.home"))))},Ea=function(){return r.a.createElement(f,null,r.a.createElement(l,null,r.a.createElement($,null,r.a.createElement(ht,null,r.a.createElement(Ut,null),r.a.createElement(Wt,null),r.a.createElement(s.b,{exact:!0,path:"/"},r.a.createElement(Ae,null)),r.a.createElement(s.b,{exact:!0,path:"/device_test"},r.a.createElement(gt,null)),r.a.createElement(s.b,{exact:!0,path:"/classroom/one-to-one"},r.a.createElement(Rt,null,r.a.createElement(va,null))),r.a.createElement(s.b,{exact:!0,path:"/classroom/small-class"},r.a.createElement(Rt,null,r.a.createElement(fa,null))),r.a.createElement(s.b,{exact:!0,path:"/classroom/big-class"},r.a.createElement(Rt,null,r.a.createElement(ba,null))),r.a.createElement(s.b,{exact:!0,path:"/replay/:uuid/:startTime/:endTime/:mediaUrl"},r.a.createElement(zt,null)),r.a.createElement(s.b,{exact:!0,path:"/404"},r.a.createElement(_a,null))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(Ea,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[152,1,2]]]);